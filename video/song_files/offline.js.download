(function(g){var window=this;'use strict';var sWA=function(v){var J=new g.o3("und",new g.q5("Default","und",!0));J.captionTracks=v.captionTracks;return J},RCm=function(v){return new g.yr(function(J,G){var K=v.length,V=[];
if(K)for(var Y=function(P,D){K--;V[P]=D;K==0&&J(V)},r=function(P){G(P)},E,e=0;e<v.length;e++)E=v[e],g.Mcm(E,g.jm(Y,e),r);
else J(V)})},Sq=function(v){this.T=v},fx=function(){Sq.apply(this,arguments)},lZo=function(){fx.apply(this,arguments)},TWX=function(){fx.apply(this,arguments)},puY=function(){fx.apply(this,arguments)},LV8=function(){fx.apply(this,arguments)},yC8=function(){fx.apply(this,arguments)},wuU=function(){fx.apply(this,arguments)},OuT=function(){Sq.apply(this,arguments)},UE8=function(){fx.apply(this,arguments)},xE8=function(){fx.apply(this,arguments)},mE8=function(){fx.apply(this,arguments)},SnY=function(){fx.apply(this,
arguments)},fZA=function(){fx.apply(this,arguments)},ZuG=function(){fx.apply(this,arguments)},ulL=function(){fx.apply(this,arguments)},gaX=function(){fx.apply(this,arguments)},XuY=function(){fx.apply(this,arguments)},kOS=function(){fx.apply(this,arguments)},cCF=function(){fx.apply(this,arguments)},NW8=function(){fx.apply(this,arguments)},aZU=function(){Sq.apply(this,arguments)},ACm=function(){fx.apply(this,arguments)},FVm=function(){fx.apply(this,arguments)},HuA=function(){fx.apply(this,arguments)},
MTU=function(){fx.apply(this,arguments)},QW6=function(){fx.apply(this,arguments)},WVT=function(){fx.apply(this,arguments)},CLS=function(){fx.apply(this,arguments)},buY=function(){fx.apply(this,arguments)},jlG=function(){fx.apply(this,arguments)},iO_=function(){Sq.apply(this,arguments)},$fo=function(){Sq.apply(this,arguments)},vKA=function(){Sq.apply(this,arguments)},JIA=function(){fx.apply(this,arguments)},GU_=function(){fx.apply(this,arguments)},oKS=function(){fx.apply(this,arguments)},K4o=function(){fx.apply(this,
arguments)},VzF=function(){fx.apply(this,arguments)},YX6=function(){fx.apply(this,arguments)},rI_=function(){fx.apply(this,arguments)},qXF=function(){fx.apply(this,arguments)},EKL=function(){fx.apply(this,arguments)},e9G=function(){fx.apply(this,arguments)},Pq8=function(){fx.apply(this,arguments)},DfF=function(){fx.apply(this,arguments)},tzG=function(){fx.apply(this,arguments)},BnX=function(){fx.apply(this,arguments)},IQ_=function(){fx.apply(this,arguments)},h9X=function(){fx.apply(this,arguments)},
z98=function(){fx.apply(this,arguments)},nKS=function(){fx.apply(this,arguments)},dfX=function(){fx.apply(this,arguments)},slX=function(){fx.apply(this,arguments)},R9G=function(){fx.apply(this,arguments)},lQ8=function(){fx.apply(this,arguments)},TnS=function(){fx.apply(this,arguments)},p_T=function(){fx.apply(this,arguments)},L4N=function(){fx.apply(this,arguments)},yIT=function(){fx.apply(this,arguments)},w_6=function(){Sq.apply(this,arguments)},OOG=function(){fx.apply(this,arguments)},UfN=function(){fx.apply(this,
arguments)},xfF=function(){fx.apply(this,arguments)},mfF=function(){fx.apply(this,arguments)},SX8=function(){fx.apply(this,arguments)},fQ8=function(){fx.apply(this,arguments)},ZO_=function(){fx.apply(this,arguments)},u_G=function(){fx.apply(this,arguments)},gKG=function(){fx.apply(this,arguments)},X_F=function(){fx.apply(this,arguments)},kUo=function(){fx.apply(this,arguments)},cIY=function(){fx.apply(this,arguments)},Nno=function(){fx.apply(this,arguments)},aQF=function(){fx.apply(this,arguments)},
AI6=function(){fx.apply(this,arguments)},F4A=function(){fx.apply(this,arguments)},HOT=function(){fx.apply(this,arguments)},Mzo=function(){fx.apply(this,arguments)},Ql8=function(){fx.apply(this,arguments)},W4m=function(){fx.apply(this,arguments)},Cq8=function(){fx.apply(this,arguments)},bOL=function(){fx.apply(this,arguments)},jY_=function(){fx.apply(this,arguments)},iLU=function(){fx.apply(this,arguments)},$KX=function(){fx.apply(this,arguments)},v3o=function(){fx.apply(this,arguments)},J4T=function(){fx.apply(this,
arguments)},GKG=function(){fx.apply(this,arguments)},o3A=function(){fx.apply(this,arguments)},KjS=function(){fx.apply(this,arguments)},VpL=function(){fx.apply(this,arguments)},YGX=function(){fx.apply(this,arguments)},r4X=function(v){v=v.key||v.id;
if(!v)throw Error("Entity key is missing");return v},qGm=function(){if(Zj)return Zj();
var v={};Zj=g.$E("PersistentEntityStoreDb",{B7:(v.EntityStore={WV:1},v.EntityAssociationStore={WV:2},v),shared:!1,upgrade:function(J,G){G(1)&&g.Zu(g.OT(J,"EntityStore",{keyPath:"key"}),"entityType","entityType");G(2)&&(J=g.OT(J,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Zu(J,"byParentEntityKey","parentEntityKey"),g.Zu(J,"byChildEntityKey","childEntityKey"))},
version:3});return Zj()},E3G=function(v){return g.AP(qGm(),v)},eq_=function(v){return g.AP((0,g.j1o)(),v)},uG=function(v){this.token=v},gY=function(v,J){J=J===void 0?{}:J;
g.Mk.call(this,g.io6[v],Object.assign({},{name:"PESEncoderError",type:v},J));this.type=v;this.level="WARNING";Object.setPrototypeOf(this,gY.prototype)},PtF=function(v){return new gY("WRONG_DATA_TYPE",{Vg:v})},DKY=function(v){return v instanceof Error?new gY("UNKNOWN_ENCODE_ERROR",{TA:v.message}):new gY("UNKNOWN_ENCODE_ERROR")},tpA=function(v){return v instanceof Error?new gY("UNKNOWN_DECODE_ERROR",{TA:v.message}):new gY("UNKNOWN_DECODE_ERROR")},BS_=function(v,J){v=v instanceof gY?v:J(v);
g.fW(v);throw v;},ItS=function(){},hq8=function(v,J,G){try{return v.Z(J,G)}catch(K){BS_(K,DKY)}},zq8=function(v){v=(new TextEncoder).encode(v).subarray(0,16);
var J=new Uint8Array(16);J.set(v);return J},XO=function(v){this.T=v},dKA=function(v){var J=n3X[v];
if(J)return J;g.Zl(new g.Mk("Entity model not found.",{entityType:v}))},sYm=function(v,J){this.T=v;
this.X=J;this.Z={}},ltA=function(v,J){a:{v=RqX(v.X,J.version);
try{var G=v.X(J.data,J.key);break a}catch(K){BS_(K,tpA)}G=void 0}return G},kh=function(v,J,G){return v.T.objectStore("EntityStore").get(J).then(function(K){if(K){if(G&&K.entityType!==G)throw Error("Incorrect entity type");
return ltA(v,K)}})},ce=function(v,J,G){return G?(G=G.map(function(K){return kh(v,K,J)}),g.lK.all(G)):v.T.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(J)).then(function(K){return K.map(function(V){return ltA(v,V)})})},ar=function(v,J,G){var K=r4X(J),V=RqX(v.X,1),Y=Object.assign({},J);
return v.T.objectStore("EntityStore").get(K).then(function(r){if(r){if(r.entityType!==G)throw Error("Incorrect entity type");Y.entityMetadata||(r=ltA(v,r),Y.entityMetadata=r.entityMetadata)}}).then(function(){var r={key:K,
entityType:G,data:hq8(V,Y,K),version:1};return g.lK.all([g.mg(v.T.objectStore("EntityStore"),r),TS8(v,Y,G)])}).then(function(){Ns(v,K,G);
return K})},pjN=function(v,J,G){J=J.map(function(K){return ar(v,K,G)});
return g.lK.all(J)},AH=function(v,J,G){if(G==null?0:G.mE){var K=new Set;
return Ljm(v,J,K).then(function(){for(var Y=[],r=g.n(K),E=r.next();!E.done;E=r.next())Y.push(AH(v,E.value));return g.lK.all(Y).then(function(){})})}var V=g.bP(J).entityType;
return g.lK.all([v.T.objectStore("EntityStore").delete(J),y4X(v,J)]).then(function(){Ns(v,J,V)})},wj6=function(v,J){return g.kq(v.T.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(J)},function(G){return g.lK.all([G.delete(),
y4X(v,G.cursor.primaryKey)]).then(function(){Ns(v,G.cursor.primaryKey,J);return g.gI(G)})})},OLG=function(v,J,G,K){var V=RqX(v.X,1);
return kh(v,J,K).then(function(Y){if(Y){Y=g.ha(Y,G);var r={key:J,entityType:K,data:hq8(V,Y,J),version:1};return g.lK.all([g.mg(v.T.objectStore("EntityStore"),r),TS8(v,Y,K)])}}).then(function(){Ns(v,J,K);
return J})},Ns=function(v,J,G){var K=v.Z[G];
K||(K=new Set,v.Z[G]=K);K.add(J)},UKU=function(v,J,G){var K=r4X(J);
G=dKA(G);if(!G)return g.lK.resolve([]);G=new G(J);v=v.T.objectStore("EntityAssociationStore");J=[];G=g.n(G.X());for(var V=G.next();!V.done;V=G.next())J.push(g.mg(v,{parentEntityKey:K,childEntityKey:V.value}));return g.lK.all(J).then(function(Y){return Y.map(function(r){return r[1]})})},y4X=function(v,J){return v.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(J))},TS8=function(v,J,G){var K=r4X(J);
return y4X(v,K).then(function(){return UKU(v,J,G)})},Ljm=function(v,J,G){if(G.has(J))return g.lK.resolve(void 0);
G.add(J);return xK_(v,J).then(function(K){return v.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(J)).then(function(){return K})}).then(function(K){var V=g.lK.resolve(void 0);
K=g.n(K);for(var Y=K.next(),r={};!Y.done;r={Aj:void 0},Y=K.next())r.Aj=Y.value,V=V.then(function(E){return function(){return Ljm(v,E.Aj,G)}}(r));
return V}).then(function(){})},xK_=function(v,J){var G=v.T.objectStore("EntityAssociationStore");
return G.index("byParentEntityKey").getAll(IDBKeyRange.only(J)).then(function(K){var V=[];K=g.n(K);for(var Y=K.next();!Y.done;Y=K.next())Y=Y.value,V.push(G.index("byChildEntityKey").getAll(Y.childEntityKey));return g.lK.all(V)}).then(function(K){var V=[];
K=g.n(K);for(var Y=K.next();!Y.done;Y=K.next())Y=Y.value,Y.length===1&&V.push(Y[0].childEntityKey);return V})},FO=function(){},mK6=function(){this.T={};
this.T[0]=new FO;if(!g.dx("aes_pes_encoder_killswitch")){var v=this.T;try{var J=g.QC();var G=zq8(J);var K=new XO(new g.l3(G),new g.RU(G))}catch(V){throw v=V instanceof Error?new gY("KEY_CREATION_FAILED",{TA:V.message}):new gY("KEY_CREATION_FAILED"),g.fW(v),v;}v[1]=K}},RqX=function(v,J){J=J===void 0?0:J;
v=v.T[J];if(!v)throw J=new gY("INVALID_ENCODER_VERSION",{Vg:J}),g.fW(J),J;return v},He=function(v,J){g.X.call(this);
this.token=v;this.T=J;this.observers=[];v=new g.X2.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.QC());v.onmessage=this.X.bind(this);this.channel=v},Ms=function(v,J,G){var K,V,Y,r;
return g.m(function(E){if(E.T==1)return g.U(E,E3G(v.token),2);if(E.T!=3)return K=E.X,g.U(E,g.xq(K,["EntityStore","EntityAssociationStore"],J,function(e){V=new sYm(e,v.T);return G(V)}),3);
Y=E.X;V&&(r=V.Z,Object.keys(r).length>0&&(v.channel.postMessage(r),SG_(v,r)));return E.return(Y)})},QN=function(v,J,G){return Ms(v,{mode:"readwrite",
jX:!0},function(K){return ar(K,J,G)})},ftN=function(v,J){return Ms(v,{mode:"readwrite",
jX:!0},function(G){return pjN(G,J,"offlineOrchestrationActionWrapperEntity")})},ZLT=function(v,J){return Ms(v,{mode:"readwrite",
jX:!0},function(G){return AH(G,J)})},uKo=function(v){return Ms(v,{mode:"readwrite",
jX:!0},function(J){return wj6(J,"videoPlaybackPositionEntity")})},We=function(v,J,G){return Ms(v,{mode:"readonly",
jX:!0},function(K){return kh(K,J,G)})},Cx=function(v,J,G){return Ms(v,{mode:"readonly",
jX:!0},function(K){return ce(K,J,G)})},SG_=function(v,J){v=g.n(v.observers);
for(var G=v.next();!G.done;G=v.next())G=G.value,G(J)},g3m=function(){var v,J,G;
return g.m(function(K){if(K.T==1)return g.nf(K,2),g.U(K,g.jg(),4);if(K.T!=2){v=K.X;if(!v||!g.W8()||typeof g.X2.BroadcastChannel==="undefined")return K.return();J=new mK6;return K.return(new He(v,J))}G=g.lj(K);G instanceof Error&&g.fW(G);return K.return()})},bG=function(){XjU||(XjU=g3m());
return XjU},kKU=function(v){var J;
v=(J=v.options)==null?void 0:J.persistenceOption;return v==="ENTITY_PERSISTENCE_OPTION_PERSIST"||v==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},c4m=function(v){var J;
return g.m(function(G){return G.T==1?g.U(G,bG(),2):(J=G.X)?g.U(G,Ms(J,"readwrite",function(K){for(var V={},Y=g.n(v),r=Y.next(),E={};!r.done;E={XR:void 0,a7:void 0},r=Y.next())E.XR=r.value,E.XR.entityKey&&kKU(E.XR)&&(E.a7=g.mx(E.XR.payload),r=void 0,E.XR.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(r=function(e){return function(){return ar(K,e.XR.payload[e.a7],e.a7)}}(E)),E.XR.type==="ENTITY_MUTATION_TYPE_DELETE"&&(r=function(e){return function(){return AH(K,e.XR.entityKey)}}(E)),E.XR.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(r=function(e){return function(){return OLG(K,e.XR.entityKey,e.XR.payload[e.a7],e.a7)}}(E)),r&&(V[E.XR.entityKey]=V[E.XR.entityKey]?V[E.XR.entityKey].then(r):r()));
return g.lK.all(Object.values(V))}),0):G.return()})},NS6=function(v){var J;
return g.m(function(G){if(G.T==1){J=v.mutations;if(!J||J.length<=0)return G.return();if(g.J3){var K={type:"ENTITY_LOADED"};J!==void 0&&(K.payload=J);g.J3.dispatch(K)}return g.U(G,c4m(J),2)}J.length=0;g.zX(G)})},atG=function(v){return v!==void 0},A4U=function(v){var J=g.Oy();
J=Object.assign({},J);v=Object.assign({},v);for(var G in J)v[G]?(J[G]!==4&&(J[G]=v[G]),delete v[G]):J[G]!==2&&(J[G]=4);Object.assign(J,v);g.jow(J);JSON.stringify(J);return J},FjY=function(v){var J,G;
return g.m(function(K){if(K.T==1)return g.U(K,g.jg(),2);if(K.T!=3)return(J=K.X)?g.U(K,g.m6(J),3):K.return();G=K.X;return K.return(g.xq(G,["index","media","captions"],{mode:"readwrite",jX:!0},function(V){var Y=IDBKeyRange.bound(v+"|",v+"~");V=[V.objectStore("index").delete(Y),V.objectStore("media").delete(Y),V.objectStore("captions").delete(Y)];return g.lK.all(V).then(function(){})}))})},HL8=function(){var v,J;
return g.m(function(G){if(G.T==1)return g.U(G,g.jg(),2);if(G.T!=3){v=G.X;if(!v)throw g.sT("rvdfd");return g.U(G,g.m6(v),3)}J=G.X;return G.return(g.xq(J,["index","media"],{mode:"readwrite",jX:!0},function(K){var V={};return g.uK(K.objectStore("index"),{},function(Y){var r=Y.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),E=g.lK.resolve(void 0);if(r){var e=r[1];r=r[2];V[e]=V[e]||{};var P;V[e][r]=g.GCs((P=Y.getValue())==null?void 0:P.fmts)}else E=Y.delete().then(function(){});
return g.lK.all([g.gI(Y),E]).then(function(D){return g.n(D).next().value})}).then(function(){for(var Y={},r=g.n(Object.keys(V)),E=r.next();!E.done;E=r.next()){E=E.value;
var e=V[E].v;Y[E]=V[E].a&&e?1:2}var P=A4U(Y);return g.LDF(K.objectStore("media"),{},function(D){var t=D.cursor.key.match(g.YRm);t&&Y[t[1]]||K.objectStore("media").delete(D.cursor.key);return g.hem(D)}).then(function(){return P})})}))})},MpL=function(v,J){var G,K;
return g.m(function(V){if(V.T==1)return g.U(V,g.jg(),2);if(V.T!=3){G=V.X;if(!G)throw g.sT("wct");return g.U(V,g.m6(G),3)}K=V.X;return g.U(V,g.xq(K,["captions"],{mode:"readwrite",jX:!0},function(Y){var r=[];Y=Y.objectStore("captions");for(var E=0;E<J.length;E++){var e=g.mg(Y,J[E],v+"|"+J[E].metadata.vss_id);r.push(e)}return g.lK.all(r)}),0)})},QY6=function(v){var J,G,K;
return g.m(function(V){if(V.T==1)return J=IDBKeyRange.bound(v+"|",v+"~"),g.U(V,g.jg(),2);if(V.T!=3){G=V.X;if(!G)throw g.sT("gactfv");return g.U(V,g.m6(G),3)}K=V.X;return V.return(K.getAll("captions",J))})},WjN=function(v){return g.m(function(J){g.xg(v,0);
return J.return(FjY(v))})},CtY=function(v){return{context:g.bd(),
videoIds:v}},bLF=function(v){return{context:g.bd(),
playlistIds:v}},jdU=function(v){return{context:g.bd(),
offlinePlaylistSyncChecks:v}},i9U=function(){this.T=new Map},vD_=function(){$D_||($D_=new i9U);
return $D_},JU6=function(v,J){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:v},metadata:J,statusCode:void 0,csn:void 0,can:void 0}},G2_=function(v,J,G){if(!G){var K=K===void 0?!1:K;
G=v.T.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!G||K)G=g.lN(16),v.T.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",G)}v={flowNonce:G,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:J.eventType};J.metadata&&(v.flowMetadata=J.metadata);J.statusCode!==void 0&&(v.flowEventStatus=J.statusCode);J.csn&&(v.csn=J.csn);J.can&&(v.can=J.can);g.ql("flowEvent",v,void 0)},oDA=function(v){var J,G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf,j8,a,C,d,A,cF,RL,BN,pf,iU,VY,IL,p,y,w;
return g.m(function(S){if(S.T==1)return g.U(S,Ms(v,{mode:"readonly",jX:!0},function(Z){return ce(Z,"playbackData").then(function(ij){var GX=ij.map(function(VB){return VB.transfer}).filter(function(VB){return!!VB}),om=ij.map(function(VB){return VB.offlineVideoPolicy}).filter(function(VB){return!!VB}),u=ij.filter(function(VB){return!!VB.key}).map(function(VB){return g.j9(g.bP(VB.key).entityId,"downloadStatusEntity")});
GX=ce(Z,"transfer",GX);om=ce(Z,"offlineVideoPolicy",om);u=ce(Z,"downloadStatusEntity",u);var dw=GX.then(function(VB){VB=VB.reduce(function(Ys,xs){(xs==null?0:xs.offlineVideoStreams)&&Ys.push.apply(Ys,g.l(xs.offlineVideoStreams));return Ys},[]).filter(function(Ys){return!!Ys});
return ce(Z,"offlineVideoStreams",VB)});
return g.lK.all([GX,om,dw,u]).then(function(VB){var Ys=g.n(VB);VB=Ys.next().value;var xs=Ys.next().value;var WF=Ys.next().value;Ys=Ys.next().value;return[ij,VB,xs,WF,Ys]})})}),2);
if(S.T!=3)return J=S.X,g.U(S,Ms(v,{mode:"readonly",jX:!0},function(Z){return ce(Z,"mainDownloadsListEntity").then(function(ij){var GX,om;return(om=(GX=ij[0])==null?void 0:GX.downloads)!=null?om:[]})}),3);
G=S.X;K=g.n(J);V=K.next().value;Y=K.next().value;r=K.next().value;E=K.next().value;e=K.next().value;P=V;D=Y;t=r;B=E;I=e;h={};R={};T={};L={};O={};x=[];f=g.n(D);for(c=f.next();!c.done;c=f.next())(b=c.value)&&(h[b.key]=b);M=g.n(t);for(Jw=M.next();!Jw.done;Jw=M.next())(Kf=Jw.value)&&(R[Kf.key]=Kf);j8=g.n(I);for(a=j8.next();!a.done;a=j8.next())(C=a.value)&&(T[C.key]=C);d=g.n(B);for(A=d.next();!A.done;A=d.next())(cF=A.value)&&(L[cF.key]=cF);RL=g.n(G);for(BN=RL.next();!BN.done;BN=RL.next())pf=BN.value,iU=
void 0,O[(iU=pf.videoItem)!=null?iU:""]=!0,pf.videoItem&&(IL=VY=void 0,p=(IL=(VY=g.bP(pf.videoItem))==null?void 0:VY.entityId)!=null?IL:"",x.push({externalVideoId:p}));y=P.filter(function(Z){if(!Z||!Z.key||!Z.offlineVideoPolicy)return!1;Z=g.bP(Z.key).entityId;Z=g.j9(Z,"downloadStatusEntity");var ij;return!(Z&&((ij=T[Z])==null?void 0:ij.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
w=y.map(function(Z){var ij=h[Z.transfer],GX=[];if(ij==null?0:ij.offlineVideoStreams)for(var om=g.n(ij.offlineVideoStreams),u=om.next();!u.done;u=om.next())(u=L[u.value])&&GX.push(u);om=R[Z.offlineVideoPolicy];u=O;var dw=Z==null?void 0:Z.playerResponseTimestamp,VB=g.bP(om.key).entityId;Z=g.j9(VB,"mainVideoEntity");if(om.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Ys="OFFLINE_VIDEO_STATE_DISABLED";om.expirationTimestamp&&Number(om.expirationTimestamp)<Date.now()/1E3&&(Ys="OFFLINE_VIDEO_STATE_EXPIRED")}else if(om.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Ys="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(ij==null?void 0:ij.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Ys="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Ys="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Ys="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Ys="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Ys="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Ys="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Ys="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Ys==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(ij==null?void 0:ij.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Ys="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Ys="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Ys=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}VB={id:VB,videoState:Ys};if(ij==null?0:ij.cotn)VB.cotn=ij.cotn;if(ij==null?0:ij.maximumDownloadQuality)VB.selectedVideoQuality=ij==null?void 0:ij.maximumDownloadQuality;if(ij==null?0:ij.lastProgressTimeMs)VB.lastProgressTimeMs=ij.lastProgressTimeMs;dw&&(VB.playerResponseSavedTimeMs=String(Number(dw)*1E3));ij=String;dw=0;GX=g.n(GX);for(Ys=GX.next();!Ys.done;Ys=GX.next())if(Ys=Ys.value,Ys.streamsProgress){Ys=g.n(Ys.streamsProgress);for(var xs=Ys.next();!xs.done;xs=
Ys.next()){var WF=void 0;dw+=Number((WF=xs.value.numBytesDownloaded)!=null?WF:0)}}VB.downloadedBytes=ij(dw);VB.selectedOfflineMode=u[Z]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";om.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(VB.offlinePlaybackDisabledReason=om.offlinePlaybackDisabledReason);return VB});
return S.return({offlineVideos:w,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:x}}})})},KyT=function(){this.locks=navigator.locks},VdG=function(){try{var v=g.NL("ytglobal.locks_");
if(v)return v;var J;if(J=navigator){var G=navigator;J="locks"in G&&!!G.locks}if(J)return g.X2.localStorage&&g.X2.localStorage.getItem("noop"),v=new KyT,g.ks("ytglobal.locks_",v),v}catch(K){}},jM=function(){},Y_T=function(){},rUU=function(v){if(v.includes(":"))throw Error("Invalid user cache name: "+v);
return v+":"+g.QC("CacheStorage get")},q_X=function(){return g.m(function(v){if(iO!==void 0)return v.return(iO);
iO=new Promise(function(J){var G;return g.m(function(K){switch(K.T){case 1:return g.nf(K,2),g.U(K,$k.open("test-only"),4);case 4:return g.U(K,$k.delete("test-only"),5);case 5:g.Rm(K,3);break;case 2:if(G=g.lj(K),G instanceof Error&&G.name==="SecurityError")return J(!1),K.return();case 3:J("caches"in window),g.zX(K)}})});
return v.return(iO)})},eL8=function(){return g.m(function(v){if(v.T==1)return g.U(v,q_X(),2);
if(!v.X)return v.return(void 0);EDY||(EDY=new Y_T);return v.return(EDY)})},v0=function(v,J,G){g.Zl(new g.Mk("Woffle: "+v,G?{cotn:G}:""));
J instanceof Error&&g.Zl(J)},PIL=function(v){var J;
return g.m(function(G){if(G.T==1)return g.U(G,oDA(v),2);J=G.X;g.ql("offlineStateSnapshot",J);g.zX(G)})},J8=function(v){g.X.call(this);
var J=this;this.api=v;this.cO={Qer:function(){return J.T},
jew:function(){return J.X}};
typeof g.X2.BroadcastChannel!=="undefined"&&(this.T=new g.X2.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.QC()),this.T.onmessage=this.Z.bind(this),this.X=new g.X2.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.QC()),this.X.onmessage=this.L.bind(this))},GH=function(v,J){v.api.lw("onOfflineOperationFailure",J);
var G;(G=v.T)==null||G.postMessage(J)},DDN=function(v,J,G,K){var V=this;
this.U=v;this.N=J;this.visibility=G;this.C=K;this.J=this.K=this.j=this.Z=this.T=!1;this.L=new g.Qq(function(){V.Rl()});
this.cO={Bs:function(){return V.X},
Rl:function(){V.Rl()},
GVr:function(){return V.L}};
this.visibility.subscribe("visibilitystatechange",function(){V.ML()})},tdY=function(v){if(!v.Z&&!v.T){var J=VdG();
if(J){v.Z=!0;var G=g.QC("OfflineLockManager");J.request("woffle_orchestration_leader:"+G,{},function(){var K,V,Y,r;return g.m(function(E){switch(E.T){case 1:return g.nf(E,2),v.X=new g.w5,v.T=!0,v.Z=!1,g.U(E,v.U(),4);case 4:return g.U(E,v.X.promise,5);case 5:g.Rm(E,0);break;case 2:K=g.lj(E),((Y=(V=v).C)==null?0:Y.call(V,"wo_relinquish_leadership_on_lock_request_error"))||v.Rl(),K instanceof Error&&(r=K,r.args=[{name:"WoLockManagerError",EO:K.name}],g.fW(r)),g.zX(E)}})})}}},Bl_=function(v){v.T&&(v.J=
!0,oR(v))},IW_=function(v,J){v.T&&(v.j=J,oR(v))},hLN=function(v,J){v.T&&(v.K=J,oR(v))},oR=function(v){v.K&&v.j&&v.J&&v.visibility.isBackground()?g.Wq(v.L,6E4):v.L.stop()},KZ=function(v){var J;
v.offlineDeleteReason=(J=v.offlineDeleteReason)!=null?J:"OFFLINE_DELETE_REASON_UNKNOWN";var G;v.offlineModeType=(G=v.offlineModeType)!=null?G:"OFFLINE_NOW";g.ql("offlineDeleteEvent",v)},Vd=function(v,J){var G=J.videoId;
var K=J.jR;J=J.offlineModeType;v.encryptedVideoId=G;v.cotn=K==null?void 0:K.cotn;v.offlineabilityFormatType=K==null?void 0:K.maximumDownloadQuality;var V;v.isRefresh=(V=K==null?void 0:K.isRefresh)!=null?V:!1;var Y;v.softErrorCount=(Y=K==null?void 0:K.transferRetryCount)!=null?Y:0;v.offlineModeType=J!=null?J:"OFFLINE_NOW";(v.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&v.statusType==="UNKNOWN_STATUS_TYPE"||!v.transferStatusType&&!v.statusType)&&g.Zl(Error("Woffle unknown transfer status"));
g.ql("offlineTransferStatusChanged",v)},zLN=function(v,J,G,K){K={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!K};J&&G&&(J=Math.floor(J/1024).toFixed(),G=Math.floor(G/1024).toFixed(),K.alreadyDownloadedKbytes=J,K.totalFetchedKbytes=J,K.totalContentKbytes=G);Vd(K,v)},nDY=function(v){Vd({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},v)},dDA=function(v){switch(v){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Yk=function(v){var J,G,K;
return((K=(J=v.actionMetadata)==null?void 0:(G=J.retryScheduleIntervalsInSeconds)==null?void 0:G.length)!=null?K:0)>0},rJ=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!v.entityKey},qp=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!v.entityKey},ES=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!v.entityKey},sdo=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!v.entityKey},
eM=function(v,J,G,K,V){V=V===void 0?!1:V;
var Y,r,E,e,P,D;return g.m(function(t){if(t.T==1)return Y=g.j9(v,J),r=g.j9(v,"downloadStatusEntity"),g.U(t,Ms(G,{mode:"readonly",jX:!0},function(B){return g.lK.all([kh(B,Y,J),kh(B,r,"downloadStatusEntity")])}),2);
E=t.X;e=E.length?E[0]:void 0;if(!e)return t.sB(0);P=RLG;if(D=E.length>1?E[1]:void 0){if(D.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!V)return t.return();D.downloadState=K}else D={key:r,downloadState:K};g.cX(e,P,D);return g.U(t,Ms(G,{mode:"readwrite",jX:!0},function(B){return g.lK.all([ar(B,e,J),ar(B,D,"downloadStatusEntity")])}),0)})},P0=function(v,J){return v.actionType===J.actionType&&v.entityKey===J.entityKey},DA=function(v,J){if(v&&v.transferState!=="TRANSFER_STATE_COMPLETE"&&v.transferState!==
"TRANSFER_STATE_FAILED"){var G=g.bP(v.key).entityId;
Vd({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:G,jR:v,offlineModeType:J})}},t8=function(v){if(!v||!v.thumbnails)return[];
var J=[];v=g.n(v.thumbnails);for(var G=v.next();!G.done;G=v.next())G=G.value,G.url&&J.push(G.url);return J},lWG=function(v,J,G){G=G===void 0?[]:G;
var K,V,Y,r,E,e,P,D,t,B,I,h,R;return g.m(function(T){if(T.T==1)return G.length?g.U(T,Cx(v,J),2):T.return([]);K=T.X;V=new Set;Y=g.n(K);for(r=Y.next();!r.done;r=Y.next())if(E=r.value,e=E.id||E.key)P=g.bP(e).entityId,V.add(P);D=[];t=g.n(G);for(B=t.next();!B.done;B=t.next())I=B.value,h=I.offlineVideoData,R=void 0,((R=h)==null?0:R.videoId)&&!V.has(h.videoId)&&D.push(I);return T.return(D)})},Tlo=function(v,J,G){return new g.FP(v,{cotn:J,
raw_player_response:G,download_media:!0,start:Infinity,disable_watch_next:!0})},pV6=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},B0=function(v,J,G,K,V,Y,r,E,e,P,D){this.entityType=v;
this.actionId=J;this.action=G;this.parentActionId=K;this.rootActionId=V===void 0?J:V;this.childActionIds=Y;this.prereqActionId=r;this.postreqActionIds=E;this.hasChildActionFailed=P;this.retryScheduleIndex=0;this.T=D||Date.now();this.retryScheduleIndex=e||0},IR=function(v){if(!v.key)throw Error("Entity key is required.");
if(!v.actionProto)throw Error("OfflineOrchestrationAction is required.");var J=g.bP(v.key),G=g.bP(v.actionProto.entityKey);return new B0(G.entityType,J.entityId,v.actionProto,v.parentActionId,v.rootActionId,v.childActionIds,v.prereqActionId,v.postreqActionIds,v.retryScheduleIndex,v.hasChildActionFailed,Number(v.enqueueTimeSec)*1E3)},h8=function(v){return{key:g.j9(v.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:v.action,parentActionId:v.parentActionId,rootActionId:v.rootActionId,childActionIds:v.childActionIds,prereqActionId:v.prereqActionId,postreqActionIds:v.postreqActionIds,retryScheduleIndex:v.retryScheduleIndex,hasChildActionFailed:v.hasChildActionFailed,enqueueTimeSec:(v.T/1E3).toFixed()}},Lyo=function(){var v;
return g.m(function(J){return J.T==1?g.U(J,eL8(),2):(v=J.X)?J.return(v.delete("yt-player-local-img")):J.return(!0)})},zH=function(v){var J,G;
return g.m(function(K){if(K.T==1)return g.U(K,eL8(),2);if(K.T!=3){J=K.X;if(!J)throw Error("Cache API not supported");return v.length?g.U(K,J.open("yt-player-local-img"),3):K.return()}G=K.X;return g.U(K,Promise.all(v.map(function(V){return G.delete(V)})),0)})},nZ=function(v){var J,G;
return g.m(function(K){if(K.T==1)return g.U(K,eL8(),2);if(K.T!=3){J=K.X;if(!J)throw Error("Cache API not supported");return v.length?g.U(K,J.open("yt-player-local-img"),3):K.return()}G=K.X;return g.U(K,G.addAll(v),0)})},dJ=function(v,J,G,K,V){var Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf,j8,a,C,d,A,cF,RL,BN,pf,iU;
return g.m(function(VY){switch(VY.T){case 1:return Y=g.j9(v,"mainVideoEntity"),r=g.j9(v,"ytMainChannelEntity"),E=g.j9(v,"transfer"),e=g.j9(v,"videoDownloadContextEntity"),g.U(VY,Ms(J,{mode:"readonly",jX:!0},function(IL){return g.lK.all([kh(IL,Y,"mainVideoEntity"),kh(IL,r,"ytMainChannelEntity"),kh(IL,E,"transfer"),kh(IL,e,"videoDownloadContextEntity"),ce(IL,"ytMainChannelEntity"),ce(IL,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:P=VY.X;D=g.n(P);t=D.next().value;B=D.next().value;I=D.next().value;h=D.next().value;R=D.next().value;T=D.next().value;L=t;O=B;x=I;f=h;c=R;b=T;if(!L&&!O){VY.sB(3);break}M=L?t8(L.thumbnail):[];if(!O){Jw=[];VY.sB(4);break}return g.U(VY,yUA(O,c),5);case 5:Jw=VY.X;case 4:return Kf=Jw,g.U(VY,zH(M.concat(Kf)),3);case 3:j8=[];a=g.j9(v,"downloadStatusEntity");C=g.n(b);for(d=C.next();!d.done;d=C.next())A=d.value,cF=g.bP(A.key).entityId,RL=IR(A),BN=g.bP(RL.action.entityKey).entityId,cF!==v&&BN!==v||P0(G,
A.actionProto)||j8.push(A.key);return g.U(VY,Ms(J,{mode:"readwrite",jX:!0},function(IL){var p=j8.map(function(y){return AH(IL,y)});
p.push(AH(IL,Y,{mE:!0}));p.push(AH(IL,a,{mE:!0}));return g.lK.all(p)}),7);
case 7:iU=(pf=f)==null?void 0:pf.offlineModeType,V&&(KZ(V),V.offlineModeType&&(iU=V.offlineModeType)),DA(x,iU),GH(K,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.zX(VY)}})},UDX=function(v,J,G,K){var V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf,j8,a,C,d,A,cF,RL,BN,pf,iU,VY,IL,p,y,w,S,Z,ij,GX,om,u,dw,VB,Ys,xs,WF,X8,CG;
return g.m(function(F2){switch(F2.T){case 1:return V=g.j9(v,"mainPlaylistEntity"),Y=g.j9(v,"ytMainChannelEntity"),g.U(F2,Ms(J,{mode:"readonly",jX:!0},function(HW){return g.lK.all([kh(HW,V,"mainPlaylistEntity"),kh(HW,Y,"ytMainChannelEntity"),ce(HW,"mainPlaylistEntity"),ce(HW,"mainDownloadsListEntity"),ce(HW,"ytMainChannelEntity"),ce(HW,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:r=F2.X;E=g.n(r);e=E.next().value;P=E.next().value;D=E.next().value;t=E.next().value;B=E.next().value;I=E.next().value;h=e;R=P;T=D;L=t;O=B;x=I;if(!h&&!R){F2.sB(3);break}f=h?wVN(h):[];if(!R){c=[];F2.sB(4);break}return g.U(F2,yUA(R,O),5);case 5:c=F2.X;case 4:return b=c,g.U(F2,zH(f.concat(b)),3);case 3:M=[];Jw=new Map;if(!h){F2.sB(7);break}return g.U(F2,O9Y(h,T,L),8);case 8:M=F2.X;Kf=g.n(M);for(j8=Kf.next();!j8.done;j8=Kf.next())a=j8.value,Jw.set(a,{videoId:a,playlistId:v,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.U(F2,Ms(J,{mode:"readonly",jX:!0},function(HW){return g.lK.all([ce(HW,"transfer"),ce(HW,"videoDownloadContextEntity")])}),9);
case 9:C=F2.X;d=g.n(C);A=d.next().value;cF=d.next().value;RL=A;BN=cF;pf=g.n(RL);for(iU=pf.next();!iU.done;iU=pf.next())VY=iU.value,IL=g.bP(VY.key).entityId,(p=Jw.get(IL))&&VY&&(p.cotn=VY.cotn);y=g.n(BN);for(w=y.next();!w.done;w=y.next())S=w.value,Z=g.bP(S.key).entityId,(ij=Jw.get(Z))&&S&&(ij.offlineModeType=S.offlineModeType);case 7:GX=[];om=g.n(x);for(u=om.next();!u.done;u=om.next())dw=u.value,VB=g.bP(dw.key).entityId,Ys=IR(dw),VB!==v&&Ys.rootActionId!==v||P0(G,dw.actionProto)||GX.push(dw.key);xs=
g.j9(v,"mainPlaylistEntity");return g.U(F2,Ms(J,{mode:"readwrite",jX:!0},function(HW){var X0=GX.map(function(tA){return AH(HW,tA)});
X0.push(AH(HW,xs,{mE:!0}));return g.lK.all(X0)}),10);
case 10:if(!h){F2.sB(0);break}M.reverse();if(!M){F2.sB(0);break}WF=g.n(M);X8=WF.next();case 13:if(X8.done){F2.sB(0);break}CG=X8.value;return g.U(F2,dJ(CG,J,G,K,Jw.get(CG)),14);case 14:X8=WF.next(),F2.sB(13)}})},mD8=function(v,J,G,K){var V,Y,r,E,e,P,D,t,B;
return g.m(function(I){if(I.T==1)return V=g.j9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),Y=new Map,g.U(I,Ms(v,{mode:"readwrite",jX:!0},function(h){var R=ce(h,"transfer"),T=ce(h,"offlineOrchestrationActionWrapperEntity"),L=ce(h,"videoDownloadContextEntity"),O=kh(h,V,"mainDownloadsListEntity");return g.lK.all([R,T,L,O]).then(function(x){x=g.n(x);var f=x.next().value;var c=x.next().value;var b=x.next().value;var M=x.next().value;x=xDN.map(function(Kf){return wj6(h,Kf)});
c=g.n(c);for(var Jw=c.next();!Jw.done;Jw=c.next())Jw=Jw.value,P0(J,Jw.actionProto)||x.push(AH(h,Jw.key,{mE:!0}));M&&(M.downloads=[],x.push(ar(h,M,"mainDownloadsListEntity")));if(b)for(b=g.n(b),M=b.next();!M.done;M=b.next())M=M.value,c=g.bP(M.key).entityId,c=g.j9(c,"transfer"),Y.set(c,M.offlineModeType);return g.lK.all(x).then(function(){return f})})}),2);
r=I.X;E=g.n(r);for(e=E.next();!e.done;e=E.next())P=e.value,DA(P,Y.get(P.key)),D=g.bP(P.key).entityId,t={videoId:D,offlineDeleteReason:K,cotn:P.cotn,offlineModeType:Y.get(P.key)},KZ(t),B=g.j9(D,"mainVideoEntity"),GH(G,{entityKey:B,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.U(I,Lyo(),0)})},wVN=function(v,J){var G=[];
if(v.thumbnailStyleData){v=g.n(v.thumbnailStyleData);for(var K=v.next();!K.done;K=v.next()){var V=void 0,Y=void 0,r=void 0;G=G.concat(t8((V=K.value)==null?void 0:(Y=V.value)==null?void 0:(r=Y.collageThumbnail)==null?void 0:r.coverThumbnail))}}J=t8(J);return G.concat(J)},O9Y=function(v,J,G){var K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf;
return g.m(function(j8){K=[];V=new Set;if(G.length)for(Y=g.n(G),r=Y.next();!r.done;r=Y.next())if(E=r.value,e=void 0,(e=E.downloads)==null?0:e.length)for(P=g.n(E.downloads),D=P.next();!D.done;D=P.next())t=D.value,t.videoItem&&(B=g.bP(t.videoItem).entityId,V.add(B));if(v.videos){I=g.n(v.videos);for(h=I.next();!h.done;h=I.next())R=h.value,T=JSON.parse(g.bP(R).entityId),T.videoId&&!V.has(T.videoId)&&K.push(T.videoId);L=g.n(J);for(O=L.next();!O.done;O=L.next())if(x=O.value,x.key!==v.key&&(f=x.videos))for(c=
g.n(f),b=c.next();!b.done;b=c.next())M=b.value,Jw=JSON.parse(g.bP(M).entityId),Jw.videoId&&(Kf=K.indexOf(Jw.videoId),Kf!==-1&&K.splice(Kf,1))}return j8.return(K)})},yUA=function(v,J){var G,K,V,Y,r,E,e,P;
return g.m(function(D){G=t8(v.avatar);K=g.n(J);for(V=K.next();!V.done;V=K.next())if(Y=V.value,Y.id!==v.id)for(r=g.n(t8(Y.avatar)),E=r.next();!E.done;E=r.next())e=E.value,P=G.indexOf(e),P!==-1&&G.splice(P,1);return D.return(G)})},S_N=function(v){var J;
return g.m(function(G){J=g.N(v.frameworkUpdates,sS);return v.frameworkUpdates&&J?g.U(G,NS6(J),0):G.return()})},Z9F=function(v){var J;
if((J=v.onResponseReceivedActions)!=null&&J.length){var G;v=(G=g.N(g.N(v.onResponseReceivedActions[0],fW6),g.M5S))==null?void 0:G.actions;if(v!=null&&v.length)return v}},uNA=function(v){var J,G,K;
return g.m(function(V){if(V.T==1)return v?g.U(V,We(v,g.Ut,"mainDownloadsListEntity"),2):V.return([]);J=V.X;return((G=J)==null?0:(K=G.downloads)==null?0:K.length)?V.return(J.downloads.map(function(Y){var r;return(r=Y.videoItem)!=null?r:""})):V.return([])})},XV_=function(v,J){var G;
return g.m(function(K){return K.T==1?g.U(K,gDU(v,J),2):(G=K.X)?g.U(K,Ms(v,{mode:"readwrite",jX:!0},function(V){var Y=[ar(V,G.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];G.mainDownloadsListEntity&&Y.push(ar(V,G.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.lK.all(Y)}),0):K.sB(0)})},gDU=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x;
return g.m(function(f){if(f.T==1)return G=g.j9("main_downloads_library_id","mainDownloadsLibraryEntity"),K=g.j9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.U(f,Ms(v,{mode:"readonly",jX:!0},function(c){return g.lK.all([kh(c,G,"mainDownloadsLibraryEntity"),kh(c,K,"mainDownloadsListEntity")])}),2);
V=f.X;Y=g.n(V);r=Y.next().value;E=Y.next().value;e=r;P=E;e||(e={id:G});D=g.n(J);for(t=D.next();!t.done;t=D.next())if(B=t.value,B===g.Ut){if(e.smartDownloadsList)return f.return();e.smartDownloadsList=B}else if(I=g.bP(B).entityType,h={},I==="mainPlaylistEntity"?h.playlistItem=B:I==="mainVideoEntity"&&(h.videoItem=B),!g.Xb(h)){R=void 0;if((R=P)==null?0:R.downloads){T=!1;L=g.n(P.downloads);for(O=L.next();!O.done;O=L.next())if(x=O.value,x.playlistItem===B||x.videoItem===B){T=!0;break}T||P.downloads.push(h)}else P=
{id:K,downloads:[h]};e.downloadsList=K}return f.return({mainDownloadsLibraryEntity:e,mainDownloadsListEntity:P})})},k28=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T;
return g.m(function(L){if(L.T==1)return G=g.j9("main_downloads_library_id","mainDownloadsLibraryEntity"),K=g.j9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.U(L,Ms(v,{mode:"readonly",jX:!0},function(O){return g.lK.all([kh(O,G,"mainDownloadsLibraryEntity"),kh(O,K,"mainDownloadsListEntity"),kh(O,g.Ut,"mainDownloadsListEntity")])}),2);
V=L.X;Y=g.n(V);r=Y.next().value;E=Y.next().value;e=Y.next().value;P=r;D=E;t=e;if(!P)return L.sB(0);if(J===g.Ut&&((B=t)==null?0:B.downloads))t.downloads=[];else if((I=D)==null?0:I.downloads)for(h=g.bP(J).entityType,R=0;R<D.downloads.length;R++)if(T=D.downloads[R],h==="mainVideoEntity"&&T.videoItem===J){D.downloads.splice(R,1);break}else if(h==="mainPlaylistEntity"&&T.playlistItem===J){D.downloads.splice(R,1);break}return g.U(L,Ms(v,{mode:"readwrite",jX:!0},function(O){var x=[ar(O,P,"mainDownloadsLibraryEntity")];
D&&x.push(ar(O,D,"mainDownloadsListEntity"));t&&x.push(ar(O,t,"mainDownloadsListEntity"));return g.lK.all(x)}),0)})},RR=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B;
return g.m(function(I){if(I.T==1)return G=g.j9(J,"transfer"),K=g.j9(J,"videoDownloadContextEntity"),g.U(I,Ms(v,{mode:"readonly",jX:!0},function(h){return g.lK.all([kh(h,G,"transfer"),kh(h,K,"videoDownloadContextEntity")])}),2);
V=I.X;Y=g.n(V);r=Y.next().value;E=Y.next().value;e=r;P=E;B={videoId:J,cotn:(D=e)==null?void 0:D.cotn,offlineModeType:(t=P)==null?void 0:t.offlineModeType};return I.return(B)})},lO=function(v,J,G,K,V){var Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw;
return g.m(function(Kf){switch(Kf.T){case 1:return Y=g.j9(v,"musicTrack"),r=g.j9(v,"transfer"),g.U(Kf,Ms(J,{mode:"readonly",jX:!0},function(j8){return g.lK.all([kh(j8,Y,"musicTrack"),kh(j8,r,"transfer"),ce(j8,"musicTrack"),ce(j8,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=Kf.X;e=g.n(E);P=e.next().value;D=e.next().value;t=e.next().value;B=e.next().value;I=P;h=D;R=t;T=B;if(!I){Kf.sB(3);break}return g.U(Kf,cUA(I,R),4);case 4:return L=Kf.X,g.U(Kf,zH(L),3);case 3:O=[];x=g.n(T);for(f=x.next();!f.done;f=x.next())c=f.value,b=g.bP(c.key).entityId,M=IR(c),Jw=g.bP(M.action.entityKey).entityId,b!==v&&Jw!==v||P0(G,c.actionProto)||O.push(c.key);return g.U(Kf,Ms(J,{mode:"readwrite",jX:!0},function(j8){var a=O.map(function(C){return AH(j8,C)});
a.push(AH(j8,Y,{mE:!0}));return g.lK.all(a)}),6);
case 6:DA(h),V&&KZ(V),GH(K,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.zX(Kf)}})},TH=function(v,J,G,K,V){var Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf,j8,a,C,d,A,cF,RL,BN,pf,iU,VY,IL,p,y,w;
return g.m(function(S){switch(S.T){case 1:return Y=g.j9(v,J),r=g.j9("music_downloads_library_id","musicDownloadsLibraryEntity"),g.U(S,Ms(G,{mode:"readonly",jX:!0},function(Z){return g.lK.all([kh(Z,Y,J),kh(Z,r,"musicDownloadsLibraryEntity"),ce(Z,J),ce(Z,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=S.X;e=g.n(E);P=e.next().value;D=e.next().value;t=e.next().value;B=e.next().value;I=P;h=D;R=t;T=B;if(!I){S.sB(3);break}return g.U(S,cUA(I,R),4);case 4:return L=S.X,g.U(S,zH(L),3);case 3:O=[];x=new Map;if(!I){S.sB(6);break}return g.U(S,Nl8(I,R,h),7);case 7:O=S.X;f=g.n(O);for(c=f.next();!c.done;c=f.next())b=c.value,M=g.bP(b).entityId,x.set(M,{videoId:M,playlistId:v,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.U(S,Cx(G,"transfer"),8);case 8:for(Jw=S.X,Kf=g.n(Jw),
j8=Kf.next();!j8.done;j8=Kf.next())a=j8.value,C=g.bP(a.key).entityId,(d=x.get(C))&&a&&(d.cotn=a.cotn);case 6:A=[];cF=g.n(T);for(RL=cF.next();!RL.done;RL=cF.next())BN=RL.value,pf=g.bP(BN.key).entityId,iU=IR(BN),pf!==v&&iU.rootActionId!==v||P0(K,BN.actionProto)||A.push(BN.key);VY=g.j9(v,J);return g.U(S,Ms(G,{mode:"readwrite",jX:!0},function(Z){var ij=A.map(function(GX){return AH(Z,GX)});
ij.push(AH(Z,VY,{mE:!0}));return g.lK.all(ij)}),9);
case 9:if(!I){S.sB(0);break}O.reverse();if(!O.length){S.sB(0);break}IL=g.n(O);p=IL.next();case 12:if(p.done){S.sB(0);break}y=p.value;w=g.bP(y).entityId;if(!w){S.sB(13);break}return g.U(S,lO(w,G,K,V,x.get(w)),13);case 13:p=IL.next(),S.sB(12)}})},pZ=function(v,J,G){var K,V,Y,r,E,e,P;
return g.m(function(D){if(D.T==1)return g.U(D,Ms(v,{mode:"readwrite",jX:!0},function(t){var B=ce(t,"transfer"),I=ce(t,"offlineOrchestrationActionWrapperEntity");return g.lK.all([B,I]).then(function(h){h=g.n(h);var R=h.next().value;var T=h.next().value;h=aWT.map(function(f){return wj6(t,f)});
T=g.n(T);for(var L=T.next();!L.done;L=T.next()){L=L.value;var O=g.bP(L.actionProto.entityKey).entityType==="musicTrack",x=L.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";P0(J,L.actionProto)||O&&(!O||x)||h.push(AH(t,L.key,{mE:!0}))}return g.lK.all(h).then(function(){return R})})}),2);
K=D.X;V=g.n(K);for(Y=V.next();!Y.done;Y=V.next())r=Y.value,DA(r),E=g.bP(r.key).entityId,e={videoId:E,offlineDeleteReason:void 0,cotn:r.cotn},KZ(e),P=g.j9(E,"musicTrack"),GH(G,{entityKey:P,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.U(D,Lyo(),0)})},AUX=function(v){for(var J,G=g.n(v.additionalMetadatas),K=G.next();!K.done;K=G.next())K=K.value,K.offlineMusicVideoData&&(J=K.offlineMusicVideoData);
var V,Y,r,E,e;return{id:g.j9(v.videoId,"musicTrack"),videoId:v.videoId,title:v.title,thumbnailDetails:v.thumbnail,lengthMs:String(Number(v.lengthSeconds)*1E3),albumTitle:(V=J)==null?void 0:V.releaseTitle,musicVideoType:(Y=J)==null?void 0:Y.musicVideoType,contentRating:{explicitType:(r=J)==null?void 0:r.explicitType},artistNames:((E=J)==null?void 0:E.byline)||((e=J)==null?void 0:e.channelName),downloadMetadata:g.j9(v.videoId,"musicTrackDownloadMetadataEntity")}},Nl8=function(v,J,G){var K,V,Y,r,E,e,
P,D,t,B,I,h,R,T,L,O,x,f;
return g.m(function(c){K=[];V=new Set;if((Y=G)==null?0:(r=Y.downloadedTracks)==null?0:r.length)for(E=g.n(G.downloadedTracks),e=E.next();!e.done;e=E.next())P=e.value,V.add(P);if(v.tracks){D=g.n(v.tracks);for(t=D.next();!t.done;t=D.next())B=t.value,V.has(B)||K.push(B);I=g.n(J);for(h=I.next();!h.done;h=I.next())if(R=h.value,R.id!==v.id&&(T=R.tracks))for(L=g.n(T),O=L.next();!O.done;O=L.next())x=O.value,f=K.indexOf(x),f!==-1&&K.splice(f,1)}return c.return(K)})},cUA=function(v,J){var G,K,V,Y,r,E,e,P;
return g.m(function(D){G=t8(v.thumbnailDetails);K=g.n(J);for(V=K.next();!V.done;V=K.next())if(Y=V.value,Y.id!==v.id)for(r=g.n(t8(Y.thumbnailDetails)),E=r.next();!E.done;E=r.next())e=E.value,P=G.indexOf(e),P!==-1&&G.splice(P,1);return D.return(G)})},Fy8=function(v,J){var G,K,V,Y,r,E,e,P,D;
return g.m(function(t){if(t.T==1)return G=g.j9("music_downloads_library_id","musicDownloadsLibraryEntity"),g.U(t,We(v,G,"musicDownloadsLibraryEntity"),2);(K=t.X)||(K={id:G});V=g.bP(J).entityType;V==="musicTrack"?(Y=K.downloadedTracks)!=null&&Y.includes(J)||(K.downloadedTracks=((r=K.downloadedTracks)!=null?r:[]).concat(J)):V==="musicPlaylist"?(E=K.downloadedPlaylists)!=null&&E.includes(J)||(K.downloadedPlaylists=((e=K.downloadedPlaylists)!=null?e:[]).concat(J)):V!=="musicAlbumRelease"||(P=K.downloadedAlbumReleases)!=
null&&P.includes(J)||(K.downloadedAlbumReleases=((D=K.downloadedAlbumReleases)!=null?D:[]).concat(J));return g.U(t,QN(v,K,"musicDownloadsLibraryEntity"),0)})},H9L=function(v,J){var G,K,V,Y,r,E,e;
return g.m(function(P){if(P.T==1)return G=g.j9("music_downloads_library_id","musicDownloadsLibraryEntity"),g.U(P,We(v,G,"musicDownloadsLibraryEntity"),2);K=P.X;if(!K)return P.sB(0);V=g.bP(J).entityType;V==="musicTrack"?Y=K.downloadedTracks:V==="musicPlaylist"&&(Y=K.downloadedPlaylists);if((r=Y)==null?0:r.length)for(E=0;E<Y.length;E++)if(e=Y[E],e===J){Y.splice(E,1);break}return g.U(P,QN(v,K,"musicDownloadsLibraryEntity"),0)})},MdY=function(v){var J=v.videos;
v=[];var G=[];if(J){J=g.n(J);for(var K=J.next();!K.done;K=J.next()){var V=K.value.offlineVideoData.videoId;K=g.j9(V,"musicTrack");V=g.j9(V,"musicTrackDownloadMetadataEntity");v.push(K);G.push(V)}}return{Aa:v,bu:G}},LZ=function(v,J,G){J={track:AUX(J)};
G&&(J.playlistId=G);if(v=g.N(v.actionMetadata,QdF))J.maximumDownloadQuality=v.maximumDownloadQuality;return{musicTrackEntityActionMetadata:J}},CIN=function(v){var J,G,K,V,Y,r,E,e;
return g.m(function(P){switch(P.T){case 1:return J=g.VA(),G=CtY(v),K=g.$n(WyY),g.nf(P,2),Y={e9:!0},g.U(P,g.WB(J,G,K,void 0,Y),4);case 4:V=P.X;g.Rm(P,3);break;case 2:r=g.lj(P);if(r instanceof g.Gp)throw E="GetOffline network manager error: "+r.message,v0(E,r),Error(E);v0("GetOffline fetch request error",r);throw Error("GetOffline fetch request error");case 3:e=yd(V);if(!V)throw v0("Network request failed"),Error("Network request failed");if(e!==void 0)wJ(e);else if(!V.videos||!V.videos.length)throw v0("No data"),
Error("No data");return P.return(V.videos.map(function(D){return D.offlineVideoData}))}})},b9X=function(v){var J,G,K,V,Y,r,E,e;
return g.m(function(P){switch(P.T){case 1:return J=g.VA(),G=bLF(v),K=g.$n(WyY),g.nf(P,2),Y={e9:!0},g.U(P,g.WB(J,G,K,void 0,Y),4);case 4:V=P.X;g.Rm(P,3);break;case 2:r=g.lj(P);if(r instanceof g.Gp)throw E="GetOffline network manager error for playlist: "+r.message,v0(E,r),Error(E);v0("GetOffline fetch request error for playlist",r);throw Error("GetOffline fetch request error for playlist");case 3:e=yd(V);if(!V)throw v0("Network request failed for playlist"),Error("Network request failed for playlist");
if(e!==void 0)wJ(e,"playlist");else if(!V.playlists||!V.playlists.length)throw v0("No data for playlist"),Error("No data for playlist");return P.return(V.playlists.map(function(D){return D.offlinePlaylistData}))}})},iMU=function(v,J,G,K){var V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf,j8,a,C,d,A,cF,RL,BN;
return g.m(function(pf){switch(pf.T){case 1:return g.U(pf,bG(),2);case 2:V=pf.X;if(!V)return pf.return([]);Y=[];if((r=K)==null?0:r.length){Y=K;pf.sB(3);break}return g.U(pf,Cx(V,"mainPlaylistEntity"),4);case 4:Y=pf.X;case 3:if(!Y.length)return pf.return([]);E=[];e=Date.now()/1E3;P=g.n(Y);D=P.next();case 5:if(D.done)return E.length?g.U(pf,jJN(E),10):pf.return([]);t=D.value;if(!t.downloadState){B=void 0;pf.sB(8);break}return g.U(pf,We(V,t.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:B=
pf.X;case 8:I=B;h=void 0;T=(R=(h=t)==null?void 0:h.entityMetadata)&&R.nextAutoRefreshIntervalSeconds?Number(R.nextAutoRefreshIntervalSeconds):NaN;L=Number.isNaN(T)?v:T;x=O=void 0;f=((O=I)==null?0:O.lastSyncedTimestampMillis)?Number((x=I)==null?void 0:x.lastSyncedTimestampMillis)/1E3:0;b=c=void 0;M=((c=I)==null?0:c.addedTimestampMillis)?Number((b=I)==null?void 0:b.addedTimestampMillis)/1E3:0;if(G||!R||f+L<=e){Jw=[];Kf=void 0;if((Kf=t.videos)==null?0:Kf.length)for(j8=g.n(t.videos),a=j8.next();!a.done;a=
j8.next())C=a.value,d=JSON.parse(g.bP(C).entityId),d.videoId&&Jw.push(d.videoId);A="0";R&&(cF=void 0,A=String(Number((cF=R.offlineLastModifiedTimestampSeconds)!=null?cF:0).toFixed()));RL={playlistId:t.playlistId,videoIds:Jw,offlineLastModifiedTimestamp:A,autoSync:J,offlineDateAddedTimestamp:String(M.toFixed())};E.push(RL)}D=P.next();pf.sB(5);break;case 10:return BN=pf.X,pf.return(BN)}})},$3U=function(){var v,J,G,K,V;
return g.m(function(Y){if(Y.T==1)return g.U(Y,bG(),2);if(Y.T!=3)return(v=Y.X)?g.U(Y,Cx(v,"refresh"),3):Y.return(!1);J=Y.X;if((G=J[0])==null||!G.refreshTime)return Y.return(!1);K=Number(J[0].refreshTime);V=Date.now()/1E3;return Y.return(isFinite(K)&&V>=K)})},JST=function(v,J){var G,K,V;
return g.m(function(Y){switch(Y.T){case 1:return g.nf(Y,2),g.U(Y,v2L(v,J),4);case 4:return K=Y.X,g.U(Y,S_N(K),5);case 5:G=Z9F(K);g.Rm(Y,3);break;case 2:V=g.lj(Y),v0("getAndProcessSmartDownloadsResponse request or processing error",V);case 3:return Y.return(G)}})},GlG=function(v,J,G,K){var V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf,j8,a,C,d,A,cF,RL,BN;
return g.m(function(pf){switch(pf.T){case 1:return g.U(pf,bG(),2);case 2:V=pf.X;if(!V)return pf.return([]);Y=[];if((r=K)==null?0:r.length){Y=K;pf.sB(3);break}return g.U(pf,Cx(V,"musicPlaylist"),4);case 4:Y=pf.X;case 3:if(!Y.length)return pf.return([]);E=[];e=Date.now()/1E3;P=g.n(Y);D=P.next();case 5:if(D.done)return E.length?g.U(pf,jJN(E),10):pf.return([]);t=D.value;B=void 0;h=(I=(B=t)==null?void 0:B.entityMetadata)&&I.nextAutoRefreshIntervalSeconds?Number(I.nextAutoRefreshIntervalSeconds):NaN;R=
Number.isNaN(h)?v:h;L=T=0;O="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!t.downloadMetadata){pf.sB(8);break}return g.U(pf,We(V,t.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:x=pf.X,c=f=void 0,T=Number((c=(f=x)==null?void 0:f.addedTimestampMillis)!=null?c:"0")/1E3,M=b=void 0,L=Number((M=(b=x)==null?void 0:b.lastModifiedTimestampMillis)!=null?M:"0")/1E3,Kf=Jw=void 0,O=(Kf=(Jw=x)==null?void 0:Jw.syncState)!=null?Kf:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:j8=void 0;if(G||O!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!I||Number((j8=I.lastSyncedTimestampSeconds)!=null?j8:0)+R<=e){a=[];C=void 0;if((C=t.tracks)==null?0:C.length)for(d=g.n(t.tracks),A=d.next();!A.done;A=d.next())cF=A.value,a.push(g.bP(cF).entityId);RL={playlistId:t.playlistId,videoIds:a,offlineLastModifiedTimestamp:String(L.toFixed()),autoSync:J,offlineDateAddedTimestamp:String(T.toFixed())};E.push(RL)}D=P.next();pf.sB(5);break;case 10:return BN=pf.X,pf.return(BN)}})},v2L=function(v,J){var G,K,V,Y,r,E,e,P,D,t;
return g.m(function(B){switch(B.T){case 1:return G=g.VA(),g.U(B,bG(),2);case 2:K=B.X;if(!K){B.sB(3);break}return g.U(B,oDA(K),4);case 4:V=B.X;case 3:var I=V;Y={context:g.bd(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:v},offlineClientState:I,clientStateRequestData:{preferredFormatType:J}}}};r=g.$n(o2Y);g.nf(B,5);e={e9:!0};return g.U(B,g.WB(G,Y,r,void 0,e),7);case 7:E=B.X;g.Rm(B,6);break;case 5:P=g.lj(B);if(P instanceof g.Gp)throw D=
"DPS network manager error for smart downloads: "+P.message,v0(D,P),Error(D);v0("DPS fetch request error for smart downloads",P);throw Error("DPS fetch request error for smart downloads");case 6:t=yd(E);if(E)t!==void 0&&wJ(t,"smart downloads");else throw v0("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return B.return(E)}})},Vym=function(v,J){var G,K,V,Y,r,E,e,P;
return g.m(function(D){switch(D.T){case 1:return G=g.VA(),K={context:g.bd(),videoPlaybackPositionEntities:v,lastSyncTimestampUsec:J},V=g.$n(KGG),g.nf(D,2),r={e9:!0},g.U(D,g.WB(G,K,V,void 0,r),4);case 4:Y=D.X;g.Rm(D,3);break;case 2:E=g.lj(D);if(E instanceof g.Gp)throw e="VPPS network manager error: "+E.message,v0(e,E),Error(e);v0("VPPS fetch request error",E);throw Error("VPPS fetch request error");case 3:P=yd(Y);if(Y)P!==void 0&&wJ(P,"position sync");else throw v0("Network request failed for position sync"),
Error("Network request failed for position sync");return D.return(Y)}})},rS8=function(v,J,G){var K,V,Y,r,E,e,P,D;
return g.m(function(t){switch(t.T){case 1:K=g.VA();var B=G.refreshData,I=G.isEnqueuedForExpiredStreamUrlRefetch,h=G.Uz,R=G.offlineSourceData,T=G.mediaCapabilities,L={entityKey:v};B&&(L.refreshData=B);I&&(L.isExpiredStreamUrlRefetch=I);h&&(L.downloadParameters=h);R&&(L.offlineSourceData=R);B={context:g.Y1(J),signatureTimestamp:20180,videos:[L]};T&&(B.mediaCapabilities=T);V=B;Y=g.$n(Y5N);g.nf(t,2);E={e9:!0};return g.U(t,g.WB(K,V,Y,void 0,E),4);case 4:r=t.X;g.Rm(t,3);break;case 2:e=g.lj(t);if(e instanceof
g.Gp)throw P="GetPDE network manager error: "+e.message,v0(P,e),Error(P);v0("GetPDE fetch request error",e);throw Error("GetPDE fetch request error");case 3:D=yd(r);if(r)D!==void 0&&wJ(D,"PDE");else throw v0("Network request failed for PDE"),Error("Network request failed for PDE");return t.return(r)}})},yd=function(v){var J;
return(J=v.errorMetadata)==null?void 0:J.status},wJ=function(v,J){J=J?" for "+J:"";
if(v===0)throw v="Empty response body"+J,v0(v),Error(v);v="Response with error"+J;v0(v);throw Error(v);},jJN=function(v){var J,G,K,V,Y,r,E,e;
return g.m(function(P){switch(P.T){case 1:return J=g.VA(),G=jdU(v),K=g.$n(q5_),g.nf(P,2),Y={e9:!0},g.U(P,g.WB(J,G,K,void 0,Y),4);case 4:V=P.X;g.Rm(P,3);break;case 2:r=g.lj(P);if(r instanceof g.Gp)throw E="offlinePlaylistSyncCheck network manager error: "+r.message,v0(E,r),Error(E);v0("offlinePlaylistSyncCheck fetch request error",r);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:e=yd(V);if(!V)throw v0("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(e!==void 0)wJ(e,"playlist sync");else if(!V.offlinePlaylistSyncCheckDatas||!V.offlinePlaylistSyncCheckDatas.length)throw v0("No data for playlist sync"),Error("No data for playlist sync");return P.return(V.offlinePlaylistSyncCheckDatas.map(function(D){return D.offlinePlaylistSyncCheckData}))}})},OS=function(v){this.T=v},E2m=function(v,J){var G,K,V,Y,r,E;
return g.m(function(e){switch(e.T){case 1:G=new Map,K=g.n(J),V=K.next();case 2:if(V.done){e.sB(4);break}Y=V.value;r=G;E=r.set;return g.U(e,v.X(Y),5);case 5:E.call(r,Y,e.X);V=K.next();e.sB(2);break;case 4:return e.return(G)}})},US=function(v,J,G,K,V,Y){J=g.j9(J,G);
K=Object.assign({},Y,{priority:K,retryScheduleIntervalsInSeconds:V});return{actionType:v,entityKey:J,actionMetadata:K}},xk=function(v,J,G,K,V,Y){this.status=v;
this.T=J;this.L=G;this.X=K;this.Z=V;this.downloadState=Y},ewG=function(v,J,G){this.T=v;
this.EB=J;this.Z=G},tyX=function(v,J){var G,K,V,Y,r,E,e,P,D;
return g.m(function(t){switch(t.T){case 1:return G=J.entityKey,V=(K=g.N(J.actionMetadata,mC))==null?void 0:K.isEnqueuedForExpiredStreamUrlRefetch,g.nf(t,2),Y=void 0,g.U(t,P46(v,J),4);case 4:Y=t.X;g.nf(t,5);var B=(B=g.N(J.actionMetadata,mC))?{maximumDownloadQuality:B.maximumDownloadQuality}:void 0;return g.U(t,rS8(G,v.EB,{isEnqueuedForExpiredStreamUrlRefetch:V,Uz:B,offlineSourceData:Y}),7);case 7:r=t.X;g.Rm(t,6,2);break;case 5:return g.lj(t,2),E=Yk(J)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",v0("PDE handleAdd error"),t.return(SM(J,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",E,"DOWNLOAD_STATE_FAILED"));case 6:return g.U(t,D3_(v,r,J),8);case 8:return t.return(SM(J,!0,r.orchestrationActions));case 2:return e=g.lj(t),P="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.I2&&e.type==="QUOTA_EXCEEDED"&&(P="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),v0("PDE handleAdd error"),t.return(SM(J,!1,void 0,P,D,"DOWNLOAD_STATE_FAILED"))}})},hw8=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf;
return g.m(function(j8){switch(j8.T){case 1:return G=J.entityKey,K=g.bP(G).entityId,g.U(j8,Ms(v.T,{mode:"readonly",jX:!0},function(a){var C=kh(a,G,"playbackData"),d=kh(a,g.j9(K,"offlineVideoPolicy"),"offlineVideoPolicy");a=kh(a,g.j9(K,"transfer"),"transfer");return g.lK.all([C,d,a])}),2);
case 2:V=j8.X;Y=g.n(V);r=Y.next().value;E=Y.next().value;e=Y.next().value;P=r;D=E;t=e;if(!P||!D)return j8.return(SM(J,!0));B=[];R=((h=P)==null?0:h.playerResponseJson)?JSON.parse(P.playerResponseJson):null;if(!(t&&R&&v.EB.C("html5_refresh_deprecated_downloads"))){j8.sB(3);break}I=B0Y(v,R,t);return g.U(j8,I$8(v,t),4);case 4:B=j8.X;case 3:T={lastPlayerResponseTimestampSeconds:P.playerResponseTimestamp,offlineToken:D.offlineToken,formatIds:B};L={};if((O=t)==null?0:O.maximumDownloadQuality)L.maximumDownloadQuality=
t.maximumDownloadQuality;g.nf(j8,5);x=void 0;return g.U(j8,P46(v,J),7);case 7:return x=j8.X,g.nf(j8,8),g.U(j8,rS8(G,v.EB,{refreshData:T,Uz:L,offlineSourceData:x,mediaCapabilities:I}),10);case 10:f=j8.X;g.Rm(j8,9,5);break;case 8:return g.lj(j8,5),c=Yk(J)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",v0("PDE handleRefresh error"),j8.return(SM(J,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",c,
"DOWNLOAD_STATE_FAILED"));case 9:return g.U(j8,D3_(v,f,J),11);case 11:return j8.return(SM(J,!0,f.orchestrationActions));case 5:return b=g.lj(j8),M="PDE handleRefresh error",b instanceof Error&&(M="PDE handleRefresh error: "+b.message),Jw="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Kf="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.I2&&b.type==="QUOTA_EXCEEDED"&&(Jw="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Kf="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
v0(M),j8.return(SM(J,!1,void 0,Jw,Kf,"DOWNLOAD_STATE_FAILED"))}})},P46=function(v,J){var G,K,V,Y;
return g.m(function(r){if(r.T==1)return G=g.bP(J.entityKey).entityId,K=g.j9(G,"videoDownloadContextEntity"),g.U(r,We(v.T,K,"videoDownloadContextEntity"),2);V=r.X;return(Y=V)!=null&&Y.offlineModeType?r.return({offlineModeType:V.offlineModeType}):r.return(void 0)})},D3_=function(v,J,G){var K,V,Y,r,E;
return g.m(function(e){if(e.T==1){if(!J.frameworkUpdates||!g.N(J.frameworkUpdates,sS))return e.return();if(!(g.N(J.frameworkUpdates,sS).mutations&&g.N(J.frameworkUpdates,sS).mutations.length>0&&g.N(J.frameworkUpdates,sS).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return e.sB(2);K=g.bP(g.N(J.frameworkUpdates,sS).mutations[0].entityKey).entityId;return g.U(e,RR(v.T,K),3)}if(e.T!=2){V=e.X;Y=g.N(G.actionMetadata,mC);if(E=(r=Y)==null?void 0:r.playlistId)V.playlistId=E;V.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.bh(v.EB)?g.U(e,dJ(K,v.T,G,v.Z,V),2):g.gy(v.EB)?g.U(e,lO(K,v.T,G,v.Z),2):e.sB(2)}return g.U(e,NS6(g.N(J.frameworkUpdates,sS)),0)})},SM=function(v,J,G,K,V,Y){return new xk(J?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Yk(v),G,K,V,Y)},B0Y=function(v,J,G){J=Tlo(v.EB,G.cotn,J);
G=g.rH(J);return g.fPt(J,G,v.EB)},I$8=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B;
return g.m(function(I){if(I.T==1)return G=[],g.U(I,Ms(v.T,{mode:"readonly",jX:!0},function(h){var R=[],T=J.offlineVideoStreams;if(T){T=g.n(T);for(var L=T.next();!L.done;L=T.next())R.push(kh(h,L.value,"offlineVideoStreams"))}return g.lK.all(R)}),2);
if(K=I.X)for(V=g.n(K),Y=V.next();!Y.done;Y=V.next())if(r=Y.value,E=void 0,(E=r)==null?0:E.streamsProgress)for(e=r.streamsProgress,P=0;P<e.length;P++)D=e[P],t=JSON.parse(D.formatStreamBytes),B={itag:t.itag,lmt:t.lastModified,xtags:t.xtags},G.push(B);return I.return(G)})},zw6=function(v,J){this.T=v;
this.EB=J},n28=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I;
return g.m(function(h){switch(h.T){case 1:return G=Yk(J),g.U(h,Cx(v.T,"videoPlaybackPositionEntity"),2);case 2:K=h.X;if(K.length===0)return h.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.nf(h,3);return g.U(h,uG.getInstance(),5);case 5:V=h.X;if(!V)throw Error("prefStorage is undefined");return g.U(h,V.get("psi"),6);case 6:return Y=h.X,e=(E=(r=Y)==null?void 0:r.Ku)!=null?E:"0",g.U(h,Vym(K,e),7);case 7:return P=h.X,D={isPaused:P.watchHistoryPaused,Ku:P.syncTimestampUsec},g.U(h,V.set("psi",
D),8);case 8:if(D.isPaused){h.sB(9);break}t=g.N(P.frameworkUpdates,sS);if(!P.frameworkUpdates||!t){h.sB(9);break}return g.U(h,NS6(t),9);case 9:g.Rm(h,4);break;case 3:return B=g.lj(h),I="PPE handleRefresh error: "+(B instanceof Error?B.message:"unknown error"),v0(I),h.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return h.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},sJ8=function(v,J){var G,K,V,Y,r,E,e,P;
return g.m(function(D){switch(D.T){case 1:return G=Yk(J),K=g.bP(J.entityKey).entityId,g.nf(D,2),g.U(D,uG.getInstance(),4);case 4:V=D.X;if(!V)throw Error("prefStorage is undefined");return g.U(D,V.get("psi"),5);case 5:Y=D.X;r=g.N(J.actionMetadata,d3Y);if(((E=Y)==null?void 0:E.isPaused)!==!1||(e=r)==null||!e.lastPlaybackPositionSeconds){D.sB(6);break}P={key:g.j9(K,"videoPlaybackPositionEntity"),videoId:K,lastPlaybackPositionSeconds:r.lastPlaybackPositionSeconds};return g.U(D,QN(v.T,P,"videoPlaybackPositionEntity"),
6);case 6:g.Rm(D,3);break;case 2:return g.lj(D),D.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return D.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},RwS=function(v,J){var G,K,V;
return g.m(function(Y){switch(Y.T){case 1:G=Yk(J);g.nf(Y,2);K=g.bP(J.entityKey).entityId;if(K==="!*$_ALL_ENTITIES_!*$")return g.U(Y,uKo(v.T),5);V=g.j9(K,"videoPlaybackPositionEntity");return g.U(Y,ZLT(v.T,V),5);case 5:g.Rm(Y,3);break;case 2:return g.lj(Y),Y.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},l$m=function(v,J){this.api=v;
this.T=J;this.logger=new g.rZ("woffle");this.X=!1;this.cO={EG:this.EG};this.logger.debug("Initialized OfflineMediaManager")},T0m=function(v){return g.m(function(J){return J.return(WjN(v))})},pqG=function(v){var J;
return g.m(function(G){if(G.T==1)return g.U(G,g.oc8(v),2);J=G.X;return G.return(J.filter(function(K){return!!K.url}).map(function(K){return K.url}))})},fZ=function(v,J){var G=g.Uy(J);
if(G===1||G===0)return Promise.resolve();(G=LG_(v,J))&&G.stopVideo();v.Z=0;return T0m(J)},ZA=function(v,J,G,K){G=G===void 0?!1:G;
K=K===void 0?!0:K;var V=typeof J==="string"?J:J.videoDetails.videoId;g.Uy(V)===2&&((J=LG_(v,V))?J.stopVideo():v.logger.info(function(){return"Corresponding player for "+V+" not found. Pausing anyway"}),g.xg(V,2),v.Z=2,G?yS8(v.T):K&&wqU(v.T))},LG_=function(v,J){var G;
return((G=v.player)==null?void 0:G.getVideoData().videoId)===J?v.player:null},OMY=function(v,J,G){J.getPlayerResponse();
g.xg(J.videoId,2);v.Z=2;v.X=!1;var K;(K=v.player)==null||K.dispose();v.player=v.api.HT(J);J={};v.player.Cd((J.localmediachange=v.xT,J.signatureexpired=v.RF,J.statechange=v.kSb,J),v);var V=v.EG(G);v.player.cM(g.Va(V,V,!0,"m"),!1);v.logger.debug(function(){return"Starting headless playback with quality: "+V});
v.player.pH(!1)},U3G=function(v,J){this.T=v;
this.EB=J},m38=function(v,J){var G,K;
return g.m(function(V){switch(V.T){case 1:return G=Yk(J),g.U(V,We(v.T,J.entityKey,"transfer"),2);case 2:if(K=V.X)return V.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.nf(V,3);return g.U(V,x3A(v,J),5);case 5:g.Rm(V,4);break;case 3:return g.lj(V),V.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return V.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},S5X=function(v,J){var G,K;
return g.m(function(V){switch(V.T){case 1:return G=Yk(J),g.U(V,We(v.T,J.entityKey,"transfer"),2);case 2:K=V.X;if(!K||K.transferState!=="TRANSFER_STATE_COMPLETE")return V.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.nf(V,3);return g.U(V,x3A(v,J,!0),5);case 5:g.Rm(V,4);break;case 3:return g.lj(V),V.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return V.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},f$T=function(v,J){var G,K,V,Y,r,E,e,P,D,t;
return g.m(function(B){switch(B.T){case 1:return G=Yk(J),K=g.bP(J.entityKey).entityId,g.U(B,Ms(v.T,{mode:"readonly",jX:!0},function(I){var h=kh(I,J.entityKey,"transfer");I=kh(I,g.j9(K,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.lK.all([h,I])}),2);
case 2:V=B.X;Y=g.n(V);r=Y.next().value;E=Y.next().value;e=r;P=E;if(!e||e.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return B.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.nf(B,3);e.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.U(B,QN(v.T,e,"transfer"),5);case 5:D=g.bP(e.key).entityId;Vd({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:D,jR:e,offlineModeType:(t=P)==null?void 0:t.offlineModeType});g.Rm(B,
4);break;case 3:return g.lj(B),B.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return B.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},x3A=function(v,J,G){G=G===void 0?!1:G;
var K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L;return g.m(function(O){switch(O.T){case 1:return K=g.N(J.actionMetadata,ZMY),V=g.bP(J.entityKey).entityId,Y=g.j9(V,"downloadStatusEntity"),g.U(O,Ms(v.T,{mode:"readonly",jX:!0},function(x){var f=kh(x,Y,"downloadStatusEntity");x=kh(x,g.j9(V,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.lK.all([f,x])}),2);
case 2:return r=O.X,E=g.n(r),e=E.next().value,P=E.next().value,D=e,t=P,B="TRANSFER_STATE_TRANSFER_IN_QUEUE",((I=D)==null?void 0:I.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(B="TRANSFER_STATE_PAUSED_BY_USER"),T={key:J.entityKey,transferState:B,cotn:g.lN(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(h=K)==null?void 0:h.maximumDownloadQuality,preferredAudioTrack:(R=K)==null?void 0:R.preferredAudioTrack,transferRetryCount:0,isRefresh:G,hasLoggedFirstStarted:!1},g.U(O,Ms(v.T,
{mode:"readwrite",jX:!0},function(x){var f=[];G&&f.push(AH(x,g.j9(V,"offlineVideoStreams")));f.push(ar(x,T,"transfer"));return g.lK.all(f)}),3);
case 3:if(!G){O.sB(4);break}return g.U(O,T0m(V),4);case 4:Vd({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:V,jR:T,offlineModeType:(L=t)==null?void 0:L.offlineModeType}),g.zX(O)}})},g2Y=function(v,J,G,K){if(!v.action.entityKey)throw Error("entityKey is missing.");
var V=g.bP(v.action.entityKey);V={entityType:V.HF,entityId:V.entityId,offlineOrchestrationActionType:v.action.actionType,orchestrationAction:{orchestrationActionId:v.actionId}};J&&(V.offlineOrchestrationActionResult=J.status,V.isRetryable=G?!1:J.T,J.Z&&(V.offlineOrchestrationFailureReason=uzU(J.Z,V.isRetryable)));var Y,r;if((Y=v.action.actionMetadata)==null?0:(r=Y.offlineLoggingData)==null?0:r.offlineModeType)V.offlineModeType=v.action.actionMetadata.offlineLoggingData.offlineModeType;K&&(V.additionalOrchestrationActions=
K.map(function(E){return{orchestrationActionId:E.actionId}}));
return V},uzU=function(v,J){return v!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||J?v==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&J?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":v:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},XqX=function(v,J){var G={offlineOrchestrationContext:g2Y(v)};
J=JU6(J,G);G2_(vD_(),J,v.rootActionId)},klA=function(v,J,G,K){K=K===void 0?[]:K;
J={offlineOrchestrationContext:g2Y(v,J,G,K)};J=JU6(3,J);G2_(vD_(),J,v.rootActionId)},cSX=function(){this.actions=[]},N0F=function(v,J){J=g.n(J);
for(var G=J.next();!G.done;G=J.next())G=G.value,XqX(G,1),v.actions.push(G);v.actions.sort(v.T)},a$S=function(v,J){if(J)for(var G=0;G<v.actions.length;G++)if(J==="!*$_ALL_ENTITIES_!*$"&&v.actions[G].actionId!==J||J!=="!*$_ALL_ENTITIES_!*$"&&v.actions[G].rootActionId===J&&v.actions[G].actionId!==J)v.actions.splice(G,1),G--},ASU=function(v,J){v=g.n(v.actions);
for(var G=v.next();!G.done;G=v.next())if(G.value.actionId===J)return!0;return!1},uO=function(v,J,G,K,V){g.X.call(this);
var Y=this;this.X=v;this.dh=J;this.oY=G;this.K=K;this.EB=V;this.T=new cSX;this.j=new g.Q3;this.Z=new g.Qq(function(){Y.retry()});
this.U=NaN;this.J=!1;this.cO={D_B:function(){return Y.T},
Ps:function(){return Y.j},
zPl:function(){return Y.Z},
retry:function(){return Y.retry()}};
g.k(this,this.Z);this.N=this.X.observe(this.Ti.bind(this))},MyU=function(v,J,G,K,V){var Y;
return g.m(function(r){if(r.T==1)return Y=new uO(v,J,G,K,V),g.U(r,FGU(Y),2);HMG(Y);return r.return(Y)})},HMG=function(v){var J=v.T.actions[0];
return v.L?((J==null?void 0:J.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&v.L[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(v.J=!0),Promise.resolve()):QJ8(v)},QJ8=function(v){var J,G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L;
return g.m(function(O){switch(O.T){case 1:if(v.L)throw Error("Already processing an action");if(v.Sl())return O.return();J=v.T.actions.shift();IW_(v.oY,!J);if(J===void 0)return O.return();J.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&J.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&a$S(v.T,J.actionId);G="";J.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&J.rootActionId===J.actionId&&(G=J.actionId);K=[J];v.L=K;if(V=v.dh[J.entityType]){O.sB(2);break}v.L=
void 0;return g.U(O,QJ8(v),3);case 3:return O.return();case 2:Y=g.n(K);for(r=Y.next();!r.done;r=Y.next())E=r.value,XqX(E,2);g.nf(O,4,5);return g.U(O,E2m(V,K.map(function(x){return x.action})),7);
case 7:e=O.X,P=g.n(K),D=P.next();case 8:if(D.done){O.sB(10);break}t=D.value;B=e.get(t.action);return g.U(O,WGo(v,t,B),9);case 9:D=P.next();O.sB(8);break;case 10:a$S(v.T,G);case 5:g.TX(O);v.L=void 0;g.Lf(O,6);break;case 4:return I=g.lj(O),v0("Orchestration error",I),g.nf(O,12),g.U(O,C48(v,K),14);case 14:g.Rm(O,5);break;case 12:h=g.lj(O);v0("Orchestration retry error",h);R=g.n(K);for(T=R.next();!T.done;T=R.next())L=T.value,L.retryScheduleIndex<3&&N0F(v.T,[L]);O.sB(5);break;case 6:return g.U(O,QJ8(v),
0)}})},WGo=function(v,J,G){var K,V,Y,r,E,e,P,D,t,B,I,h;
return g.m(function(R){switch(R.T){case 1:K=J.retryScheduleIndex+2===3;if(G.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){R.sB(2);break}if(G.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){R.sB(0);break}klA(J,G,K);if(G.T&&J.retryScheduleIndex+1<3)return g.U(R,C48(v,[J]),0);Y=((V=G)==null?0:V.X)?G.X:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";r={entityKey:J.action.entityKey,failureReason:Y};E=void 0;g.bh(v.EB)?E="mainVideoDownloadStateEntity":g.gy(v.EB)&&(E="musicTrackDownloadMetadataEntity");
if(!E||!G.downloadState){R.sB(7);break}e=g.bP(J.action.entityKey).entityId;return g.U(R,eM(e,E,v.X,G.downloadState),7);case 7:GH(v.K,r);if(G.downloadState==="DOWNLOAD_STATE_FAILED"&&v.EB.C("html5_auto_retry_failed_pde_actions")){R.sB(0);break}v0("Orchestration result is not retryable, deleting action");return g.U(R,ZLT(v.X,h8(J).key),0);case 2:P=void 0;try{P=(D=G.L)==null?void 0:D.map(function(T){return v.createAction(T,J)})}catch(T){return klA(J,G,K),t={entityKey:J.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},GH(v.K,t),v0("Orchestration subactions creation error",T),R.return()}klA(J,G,K,P);if(!P){R.sB(12);break}B=P.map(function(T){return h8(T)});
I=0;case 13:if(!(I<P.length)||v.J){R.sB(15);break}return g.U(R,Ms(v.X,{mode:"readwrite",jX:!0},function(T){var L=[];L.push(pjN(T,B.slice(I,I+10),"offlineOrchestrationActionWrapperEntity"));return g.lK.all(L)}),16);
case 16:I+=10;R.sB(13);break;case 15:if(v.J)return v.J=!1,R.return();case 12:return h=h8(J),g.U(R,ZLT(v.X,h.key),17);case 17:XqX(J,4),g.zX(R)}})},$Ro=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I;
return g.m(function(h){G=[];K=Infinity;V=4E3;Y=g.n(J);for(r=Y.next();!r.done;r=Y.next())E=r.value,e=Number(E.enqueueTimeSec),P=bMT(e),D=E.retryScheduleIndex,t=D!=null&&D>0,P>0&&t?(K=Math.min(K,e),V=Math.min(P,V)):G.push(E);isFinite(K)&&(!v.Z.isActive()||K<v.U)&&(v.U=K,v.Z.start(V));v.j.B8()||(B=G.length,G=G.filter(function(R){var T;R=((T=R.actionProto)==null?void 0:T.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!j9L.includes(R)}),I=G.length<B,!v.Z.isActive()&&I&&v.Z.start(1));
G.length>0&&i7L(v,G);return g.U(h,HMG(v),0)})},JzL=function(v){var J,G,K,V,Y,r,E;
return g.m(function(e){if(e.T==1)return g.U(e,vfG(v),2);J=e.X;G=[];K=g.n(J);for(V=K.next();!V.done;V=K.next())Y=V.value,r=g.bP(Y.key),E=r.entityId,ASU(v.T,E)||G.push(Y);return g.U(e,$Ro(v,G),0)})},bMT=function(v){v=v*1E3-Date.now();
return v>4E3?4E3:v},C48=function(v,J){var G,K,V;
return g.m(function(Y){G=g.n(J);for(K=G.next();!K.done;K=G.next()){V=K.value;var r=void 0,E=void 0,e=((E=V.action)==null?void 0:(r=E.actionMetadata)==null?void 0:r.retryScheduleIntervalsInSeconds)||[1,2,4];r=1;V.retryScheduleIndex<e.length&&(r=e[V.retryScheduleIndex]);V.T=r*1E3+Date.now();V.retryScheduleIndex++}return g.U(Y,GY_(v,J),0)})},FGU=function(v){var J;
return g.m(function(G){if(G.T==1)return g.U(G,Cx(v.X,"offlineOrchestrationActionWrapperEntity"),2);J=G.X;return g.U(G,$Ro(v,J),0)})},i7L=function(v,J){J.length!==0&&J.forEach(function(G){G=IR(G);
G.retryScheduleIndex<3&&N0F(v.T,[G])})},vfG=function(v,J){var G;
return g.m(function(K){if(K.T==1)return g.U(K,Cx(v.X,"offlineOrchestrationActionWrapperEntity",J),2);G=K.X;return K.return(G.filter(atG))})},GY_=function(v,J){if(J.length===0)return Promise.resolve([]);
J=J.map(function(G){return h8(G)});
return ftN(v.X,J)},ofF=function(v){this.kB=v;
this.T=void 0},KD_=function(v,J){var G,K,V,Y;
return g.m(function(r){G=J.videoId;K=!0;if(J.captionTracks.length)V=sWA(J),v.T=new g.ED(v.kB,J,V);else if(J.Bv)Y=g.DWX(J),v.T=new g.Pv(v.kB,J.Bv,G,Y,J.Uj,J.eventId),K=J.Uj;else return r.return();return r.return(new Promise(function(E){var e;(e=v.T)==null||e.rT({Tb:function(){return g.m(function(P){if(P.T==1)return g.U(P,v.Tb(G,K),2);E();g.zX(P)})},
HL:function(){}})}))})},VjG=function(v){var J;
return g.m(function(G){if(G.T==1)return g.U(G,QY6(v),2);J=G.X;return G.return(!!J&&J.length>0)})},gJ=function(v){g.X.call(this);
this.T=v;this.X=this.T.observe(this.Z.bind(this))},Y3L=function(v,J){var G,K,V,Y,r,E,e;
return g.m(function(P){switch(P.T){case 1:if(J.length===0)return P.return([]);G=J.map(function(D){return g.j9(D,"transfer")});
return g.U(P,Cx(v.T,"transfer",G),2);case 2:K=P.X;V=K.filter(atG).map(function(D){return g.bP(D.key).entityId});
Y=J.filter(function(D){return V.indexOf(D)===-1});
if(Y.length===0)return P.return([]);r=g.n(Y);E=r.next();case 3:if(E.done){P.sB(5);break}e=E.value;return g.U(P,T0m(e),4);case 4:E=r.next();P.sB(3);break;case 5:return P.return(Y)}})},Ef8=function(v,J,G,K,V,Y){var r,E,e;
return g.m(function(P){r="STREAM_TYPE_UNKNOWN";G.video&&G.audio?(r="STREAM_TYPE_AUDIO_AND_VIDEO",v0("unexpected stream type")):G.video&&!G.audio?r="STREAM_TYPE_VIDEO":!G.video&&G.audio&&(r="STREAM_TYPE_AUDIO");E=g.j9(J,"offlineVideoStreams");e={numBytesDownloaded:V.toFixed(),numTotalBytes:Y.toFixed(),streamType:r,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(K),itag:r==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(G.itag):void 0};return g.U(P,Ms(v,{mode:"readwrite",jX:!0},
function(D){var t=kh(D,E,"offlineVideoStreams"),B=kh(D,g.j9(J,"transfer"),"transfer");return g.lK.all([t,B]).then(function(I){I=g.n(I);var h=I.next().value;I=I.next().value;if(!I)return AH(D,E).then(function(){});
var R=rz8(h);h=q3N(h,K,e,E);var T=ar(D,h,"offlineVideoStreams");rz8(h)>R&&(I.lastProgressTimeMs=Date.now().toString());R=[T];I.offlineVideoStreams||(I.offlineVideoStreams=[]);I.offlineVideoStreams.indexOf(E)===-1&&(I.offlineVideoStreams.push(E),R.push(ar(D,I,"transfer")));return g.lK.all(R)})}),0)})},eeL=function(v,J){var G,K,V,Y,r;
return g.m(function(E){if(E.T==1)return G=g.j9(J,"offlineVideoStreams"),g.U(E,We(v,G,"offlineVideoStreams"),2);K=E.X;if(!K||!K.streamsProgress)return E.return();V=g.n(K.streamsProgress);for(Y=V.next();!Y.done;Y=V.next())r=Y.value,r.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",r.numTotalBytes!==r.numBytesDownloaded&&(r.numBytesDownloaded=r.numTotalBytes);return g.U(E,QN(v,K,"offlineVideoStreams"),0)})},q3N=function(v,J,G,K){if(v&&v.streamsProgress){K=v;
a:{J=J.itag+";"+J.xtags;for(var V=v.streamsProgress,Y=0;Y<V.length;Y++){var r=JSON.parse(V[Y].formatStreamBytes);if(r.itag+";"+r.xtags===J){V[Y]=G;G=V;break a}}V.push(G);G=V}K.streamsProgress=G}else v={key:K,streamsProgress:[G]};return v},rz8=function(v){if(v==null?0:v.streamsProgress){var J=0;
v=v.streamsProgress;for(var G=0;G<v.length;G++){var K=v[G];isNaN(Number(K.numBytesDownloaded))?v0("stream progress bytes number invalid"):J+=Number(K.numBytesDownloaded)}return J}return 0},P6F=function(v,J,G,K){g.X.call(this);
var V=this;this.X=v;this.api=J;this.Gi=G;this.Ti=K;this.j=new g.Q3;this.L=new g.Qq(function(){V.T&&V.T.transferState==="TRANSFER_STATE_TRANSFERRING"&&V.j.B8()&&((V.T.transferRetryCount||0)<3?ZA(V.K,V.J,!1,!1):fZ(V.K,V.J.videoDetails.videoId),V.pU("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.oY=this.Mr=0;this.N=this.U=!1;this.RY=g.DI(this.api.B().experiments,"html5_transfer_processing_logs_interval");this.jl=new g.Zs(this);this.cO={WBb:function(){return V.L},
ynh:function(){return V.Ti},
Ps:function(){return V.j}};
this.dh=this.X.observe(this.Y8.bind(this));this.K=new l$m(J,this);this.xB=new ofF(J);this.Ze=new gJ(this.X);this.YB=this.j.listen("publicytnetworkstatus-online",this.fh.bind(this));this.qr=this.j.listen("publicytnetworkstatus-offline",this.ujw.bind(this));this.N=this.api.B().C("html5_less_transfer_processing_logs");g.k(this,this.jl);this.jl.G(J,"offlinetransferpause",this.orh);g.bh(this.api.B())?this.Z="mainVideoDownloadStateEntity":g.gy(this.api.B())&&(this.Z="musicTrackDownloadMetadataEntity")},
DRN=function(v){return g.m(function(J){if(J.T==1)J=g.U(J,HL8(),2);
else{var G=v.Ze;var K=g.Oy();K=Object.keys(K);G=Y3L(G,K);J=g.U(J,G,0)}return J})},kk=function(v,J){J=J===void 0?!1:J;
var G;return g.m(function(K){if(K.T==1){if(v.T)throw Error("Already downloading a video");v.oY=0;v.U=!1;return g.U(K,tjm(v),2)}return K.T!=4?(G=K.X,hLN(v.Gi,!G),G&&v.j.B8()?J?g.U(K,new Promise(function(V){g.By(V,1E3)}),4):K.sB(4):(!G&&v.T&&Xp(v),K.sB(0))):g.U(K,Bzo(v,G),0)})},Iv8=function(v){return g.m(function(J){if(J.T==1)return v.J?g.U(J,fZ(v.K,v.J.videoDetails.videoId),3):J.sB(0);
Xp(v);g.zX(J)})},heL=function(v,J){var G,K,V;
return g.m(function(Y){switch(Y.T){case 1:return g.nf(Y,2),(G=!!J.captionTracks.length||!!J.Bv)?g.U(Y,VjG(J.videoId),4):Y.return();case 4:return(K=Y.X)?Y.return():g.U(Y,KD_(v.xB,J),5);case 5:g.Rm(Y,0);break;case 2:V=g.lj(Y),v0("Caption downloading error",V,J.cotn),g.zX(Y)}})},Bzo=function(v,J){var G,K,V,Y,r,E;
return g.m(function(e){switch(e.T){case 1:if(v.U)return e.return();v.U=!0;v.T=J;G=g.bP(v.T.key);K=G.entityId;V=void 0;if(v.T.transferState==="TRANSFER_STATE_TRANSFERRING")return g.U(e,c0(v,K),7);if(v.T.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||v.T.transferRetryCount||v.T.hasLoggedFirstStarted){e.sB(3);break}return g.U(e,c0(v,K),5);case 5:return V=e.X,v.T.hasLoggedFirstStarted=!0,g.U(e,zeU(v),6);case 6:zLN({videoId:K,jR:v.T,offlineModeType:V},void 0,void 0,!0);e.sB(3);break;case 7:V=e.X,
Vd({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:K,jR:v.T,offlineModeType:V});case 3:return g.U(e,nfU(v),8);case 8:return Y=null,g.nf(e,9),g.U(e,dRY(v,J),11);case 11:Y=e.X;v.J=Y;g.Rm(e,10);break;case 9:return r=g.lj(e),v0("error getting player response",r,J.cotn),g.U(e,v.pU("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return e.return();case 10:return E=Tlo(v.api.B(),J.cotn,Y),g.U(e,heL(v,E),13);case 13:return g.U(e,pqG(E.videoId),
14);case 14:E.PL=e.X,OMY(v.K,E,J.maximumDownloadQuality),v.L.start(108E5),g.zX(e)}})},tjm=function(v){var J,G;
return g.m(function(K){if(K.T==1)return g.U(K,Cx(v.X,"transfer"),2);J=K.X;G=J.filter(s9L).sort(Re8);return G.length===0?K.return():K.return(G[0])})},nfU=function(v){var J,G,K;
return g.m(function(V){if(V.T==1){if(!v.T)return Np(v,"onTransferStart"),V.return();v.L.start(108E5);return g.U(V,aR(v,"TRANSFER_STATE_TRANSFERRING"),2)}J=v.T;return(K=((G=J)==null?0:G.key)?g.bP(J.key).entityId:"")&&v.Z?g.U(V,eM(K,v.Z,v.X,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):V.sB(0)})},yS8=function(v){var J,G,K,V;
g.m(function(Y){switch(Y.T){case 1:if(!v.T){Np(v,"onTransferPausedByUser");Y.sB(2);break}J=v.T;v.L.stop();return g.U(Y,aR(v,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:K=((G=J)==null?0:G.key)?g.bP(J.key).entityId:"";if(!K||!v.Z){Y.sB(4);break}return g.U(Y,eM(K,v.Z,v.X,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.U(Y,c0(v,K),6);case 6:V=Y.X,nDY({videoId:K,jR:J,offlineModeType:V});case 2:Xp(v),kk(v),g.zX(Y)}})},wqU=function(v){var J,G,K;
g.m(function(V){if(V.T==1){if(!v.T)return Np(v,"onTransferPausedByNetwork"),V.return();v.L.stop();return g.U(V,aR(v,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(V.T!=3)return J=v.T,(K=((G=J)==null?0:G.key)?g.bP(J.key).entityId:"")&&v.Z?g.U(V,eM(K,v.Z,v.X,"DOWNLOAD_STATE_PAUSED"),3):V.sB(3);Xp(v);g.zX(V)})},lv8=function(v){var J,G,K,V,Y;
g.m(function(r){switch(r.T){case 1:if(!v.T)return Np(v,"onTransferComplete"),r.return();J=v.T;v.L.stop();if(!J||!v.J){r.sB(2);break}G=Tlo(v.api.B(),J.cotn,v.J);return g.U(r,heL(v,G),2);case 2:return g.U(r,aR(v,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:V=((K=J)==null?0:K.key)?g.bP(J.key).entityId:"";if(!V||!v.Z){r.sB(5);break}return g.U(r,eM(V,v.Z,v.X,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.U(r,eeL(v.X,V),7);case 7:return g.U(r,c0(v,V),8);case 8:Y=r.X,Vd({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:V,jR:J,offlineModeType:Y}),Xp(v),kk(v),g.zX(r)}})},TzT=function(v,J,G){var K,V;
g.m(function(Y){switch(Y.T){case 1:if(!v.T)return Np(v,"onTransferProgress: "+J),Y.return();if(v.T.transferState==="TRANSFER_STATE_TRANSFERRING"){Y.sB(2);break}return g.U(Y,nfU(v),2);case 2:K=Date.now();if(!(K-v.Mr>1E3)){Y.sB(4);break}v.Mr=K;return g.U(Y,Ef8(v.X,G.videoId,G.X,G.zz,G.bytesDownloaded,G.T),5);case 5:if(v.N&&!(v.N&&K-v.oY>v.RY)){Y.sB(4);break}v.oY=K;return g.U(Y,c0(v,J),7);case 7:V=Y.X,zLN({videoId:J,jR:v.T,offlineModeType:V},G.bytesDownloaded,G.T);case 4:v.L.start(108E5),g.zX(Y)}})},
pYN=function(v){var J=(v.T.transferRetryCount||0)<3;
J&&(v=v.T,v.transferRetryCount=(v.transferRetryCount||0)+1);return J},LDN=function(v,J){J=J===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":J;
var G,K,V,Y;return g.m(function(r){if(r.T==1)return v.T||Np(v,"setTransferToFailed: "+J),G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J==="TRANSFER_FAILURE_REASON_NETWORK"?G="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":J==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.U(r,aR(v,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",J),2);if(r.T!=3)return GH(v.Ti,{entityKey:(K=v.T)==null?void 0:K.key,failureReason:G}),
V=v.T?g.bP(v.T.key).entityId:"",g.U(r,c0(v,V),3);Y=r.X;var E={videoId:V,jR:v.T,offlineModeType:Y},e=J,P={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};e&&(P.transferFailureReason=e,P.failureReason=dDA(e));Vd(P,E);g.zX(r)})},aR=function(v,J,G,K){var V;
return g.m(function(Y){if(Y.T==1){if(!v.T)return Np(v,"saveTransferState: "+J),Y.return();v.T.transferState=J;v.T.failureReason=K;g.nf(Y,2);return g.U(Y,zeU(v,function(r){return G?ce(r,"offlineVideoStreams",v.T.offlineVideoStreams).then(function(E){for(var e=g.n(E),P=e.next();!P.done;P=e.next())if((P=P.value)&&P.streamsProgress){P=g.n(P.streamsProgress);for(var D=P.next();!D.done;D=P.next())D.value.streamState=G}return pjN(r,E.filter(function(t){return!!t}),"offlineVideoStreams")}):g.lK.resolve(void 0)}),
4)}if(Y.T!=2)return g.Rm(Y,0);
V=g.lj(Y);return V instanceof g.I2&&V.type==="QUOTA_EXCEEDED"?g.U(Y,v.pU("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):Y.sB(0)})},zeU=function(v,J){var G;
return g.m(function(K){if(!v.T)return K.return();G=v.T;return g.U(K,Ms(v.X,{mode:"readwrite",jX:!0},function(V){var Y=[ar(V,G,"transfer")];J&&Y.push(J(V));return g.lK.all(Y)}),0)})},Xp=function(v){v.T=void 0;
v.J=void 0;v.L.stop()},dRY=function(v,J){var G,K,V,Y,r;
return g.m(function(E){if(E.T==1)return G=g.bP(J.key),K=G.entityId,V=g.j9(K,"playbackData"),g.U(E,We(v.X,V,"playbackData"),2);Y=E.X;if((r=Y)==null?0:r.playerResponseJson)return E.return(JSON.parse(Y.playerResponseJson));throw Error("No PlayerResponse found");})},Np=function(v,J){v.api.uw("woffle",{mcte:J});
v0("missing current transfer entity.")},c0=function(v,J){var G,K,V;
return g.m(function(Y){if(Y.T==1)return g.U(Y,We(v.X,g.j9(J,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);G=Y.X;return Y.return((V=(K=G)==null?void 0:K.offlineModeType)!=null?V:void 0)})},s9L=function(v){return yzA[v.transferState]!==void 0},Re8=function(v,J){var G=yzA[v.transferState],K=yzA[J.transferState];
return G!==K?G-K:Number(v.enqueuedTimestampMs)-Number(J.enqueuedTimestampMs)},A8=function(v,J){var G=this;
this.EB=v;this.api=J;this.j=new g.Q3;this.J=new g.w5;this.cO={Bs:function(){return G.Z.cO.Bs()},
Ps:function(){return G.j},
qXi:function(){return G.Z},
X1:function(){return G.X1()},
mP:function(){return G.mP()},
IZ:function(){return G.IZ()},
lG:function(){return G.lG()},
Pd:function(){return G.Pd()},
j$:function(K){return G.j$(K)}};
this.Z=new DDN(function(){return wYN(G)},function(){G.IZ()},this.api.Wo(),this.api.C.bind(this.api));
this.T=new J8(this.api);tdY(this.Z)},wYN=function(v){return g.m(function(J){v.api.lw("onOrchestrationBecameLeader");
return g.U(J,v.mP(),0)})},URN=function(v){var J,G;
return g.m(function(K){if(K.T==1)return g.U(K,bG(),2);if(K.T!=3){J=K.X;if(!J)return v0("PES is undefined"),K.return();v.X=new P6F(J,v.api,v.Z,v.T);G=v.R1(J);return g.U(K,MyU(J,G,v.Z,v.T,v.EB),3)}v.K=K.X;return g.U(K,O7_(v),0)})},O7_=function(v){var J;
return g.m(function(G){switch(G.T){case 1:if(!v.X)return v0("transferManager is undefined"),G.return();if(v.X.T){G.sB(2);break}return g.U(G,kk(v.X),2);case 2:if(!v.EB.C("woffle_enable_main_downloads_library")){G.sB(4);break}return g.U(G,v.uI(),4);case 4:if(!v.EB.C("html5_offline_playback_position_sync")){G.sB(6);break}return g.U(G,v.Tt(),7);case 7:return g.U(G,v.j$(864E5),6);case 6:return g.U(G,v.refreshAllStaleEntities(43200,!0),9);case 9:return g.U(G,v.r3(),10);case 10:if(!v.EB.C("html5_retry_downloads_for_expiration")){G.sB(11);
break}return g.U(G,v.Pd(),11);case 11:return v.U=g.IS(function(){v.refreshAllStaleEntities(43200,!0);v.r3()},9E5),g.jQ(g.$q(),function(){return v.lG()}),g.U(G,bG(),13);
case 13:return J=G.X,g.U(G,PIL(J),14);case 14:Bl_(v.Z),g.zX(G)}})},xRF=function(){var v,J,G,K,V,Y;
return g.m(function(r){switch(r.T){case 1:return g.U(r,bG(),2);case 2:v=r.X;if(!v)return r.return([]);J=Date.now()/1E3;return g.U(r,Cx(v,"offlineVideoPolicy"),3);case 3:G=r.X,K=g.n(G),V=K.next();case 4:if(V.done){r.sB(6);break}Y=V.value;if(!(Y.expirationTimestamp&&Number(Y.expirationTimestamp)<J)){r.sB(5);break}Y.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";Y.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.U(r,QN(v,Y,"offlineVideoPolicy"),5);
case 5:V=K.next();r.sB(4);break;case 6:return r.return(G.map(function(E){return E.key}))}})},Fp=function(v,J,G,K,V){var Y,r,E;
return g.m(function(e){if(e.T==1)return g.U(e,bG(),2);Y=e.X;if(!Y)return e.return([]);r=J.map(function(P){var D=g.j9(P,G);D={actionType:K,entityKey:D,actionMetadata:Object.assign({},pV6(),V)};K!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(D.actionMetadata.priority=0);P=new B0(G,P,D);return h8(P)});
E=ftN(Y,r);tdY(v.Z);return e.return(E)})},mRT=function(v,J,G,K){var V,Y,r,E,e,P,D,t;
return g.m(function(B){switch(B.T){case 1:V=[],Y=g.n(J),r=Y.next();case 2:if(r.done){B.sB(4);break}E=r.value;if(E.upToDate||G&&!E.shouldAutoSyncMetadata||!E.playlistId){B.sB(3);break}e={};switch(K){case "mainPlaylistEntity":P={nextAutoRefreshIntervalSeconds:E.checkInSeconds,autoSync:G};e={mainPlaylistEntityActionMetadata:P};break;case "musicPlaylist":D={autoSync:G},e={musicPlaylistEntityActionMetadata:D}}return g.U(B,Fp(v,[E.playlistId],K,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",e),6);case 6:(t=
B.X)&&V.push.apply(V,g.l(t));case 3:r=Y.next();B.sB(2);break;case 4:return B.return(V)}})},S3_=function(v,J){var G;
return g.m(function(K){return J.length?(G=pV6(),g.cX(G,mC,{isEnqueuedForExpiredStreamUrlRefetch:!0}),v.api.uw("qrd",{v:J.length}),K.return(Fp(v,J,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G))):K.return([])})},fvo=function(v,J,G){this.T=v;
this.EB=J;this.Z=G},gfN=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O;
return g.m(function(x){switch(x.T){case 1:return G=Yk(J),K=g.bP(J.entityKey),V=K.entityId,Y=[],g.nf(x,2),g.U(x,Z7m(v,V),4);case 4:Y=x.X;if(!(v.EB.C("woffle_enable_main_downloads_library")&&((r=Y)==null?0:r.length))){x.sB(5);break}return g.U(x,XV_(v.T,[J.entityKey]),5);case 5:g.Rm(x,3);break;case 2:return E=g.lj(x),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.I2&&E.type==="QUOTA_EXCEEDED"?(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
P="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):v0("Playlist add error"),x.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,e,P));case 3:D=[];if(!v.EB.C("html5_offline_prevent_redownload_downloaded_video")){x.sB(7);break}return g.U(x,lWG(v.T,"mainVideoEntity",Y),8);case 8:Y=x.X;case 7:if((t=Y)==null?0:t.length)for(B=g.n(Y),I=B.next();!I.done;I=B.next())if(h=I.value,R=h.offlineVideoData,T=void 0,(T=R)==null?0:T.videoId)L=void 0,O=Number(((L=J.actionMetadata)==null?void 0:L.priority)||
0)+1,D.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",R.videoId,"mainVideoEntity",O,H0,u6F(J,R,V)));return x.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,D))}})},kYY=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf,j8,a,C,d,A,cF,RL,BN,pf,iU,VY,IL,p,y,w,S,Z,ij,GX,om,u,dw,VB,Ys,xs,WF,X8,CG,F2,HW,X0,tA,Aq,EA,Mh,kY,QK,Rn,eK,xb,BJ,mK,cu,NE,Tj,iy,WM,oI,fM,QZ;
return g.m(function(tE){switch(tE.T){case 1:return G=Yk(J),K=J.entityKey,V=g.bP(K).entityId,Y=[],r=!1,V==="!*$_ALL_ENTITIES_!*$"?(r=!0,g.U(tE,Cx(v.T,"mainPlaylistEntity"),5)):g.U(tE,We(v.T,K,"mainPlaylistEntity"),4);case 4:(E=tE.X)&&Y.push(E);tE.sB(3);break;case 5:Y=tE.X;case 3:if((e=Y)==null||!e.length)return tE.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));P=g.N(J.actionMetadata,XY8);t=(D=P)==null?void 0:D.nextAutoRefreshIntervalSeconds;I=(B=P)==null?void 0:B.autoSync;h=[];T=R=
!0;L=!1;if(!r&&I===!1){tE.sB(6);break}g.nf(tE,7);return g.U(tE,iMU(0,!!I,!0,Y),9);case 9:h=tE.X;g.Rm(tE,8);break;case 7:O=g.lj(tE);if(!(O instanceof Error&&O.message==="No data")){O instanceof Error&&O.message==="Empty response body"&&v0(O.message);tE.sB(8);break}return V==="!*$_ALL_ENTITIES_!*$"?g.U(tE,mD8(v.T,J,v.Z,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.U(tE,UDX(V,v.T,J,v.Z),8);case 8:if(!h.length||!r&&h[0].playlistId!==V)return tE.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G));case 6:if(r){x=[];f=g.n(h);for(c=f.next();!c.done;c=f.next())b=c.value,b.upToDate||I&&!b.shouldAutoSyncMetadata||!b.playlistId||(M={nextAutoRefreshIntervalSeconds:b.checkInSeconds,autoSync:I},x.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b.playlistId,"mainPlaylistEntity",0,H0,{mainPlaylistEntityActionMetadata:M})));return tE.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,x))}h.length&&(Jw=h[0],L=!!Jw.upToDate,I&&(R=(Kf=Jw.shouldAutoSyncMetadata)!=null?Kf:!0,T=(j8=Jw.shouldAutoSyncVideos)!=
null?j8:!0,Jw.checkInSeconds&&(t=Jw.checkInSeconds)));if(L||!R)return tE.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));a=[];C=Y[0];if(!C.downloadState){d=void 0;tE.sB(15);break}return g.U(tE,We(v.T,C.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:d=tE.X;case 15:return A=d,RL=((cF=A)==null?0:cF.addedTimestampMillis)?String(A.addedTimestampMillis):void 0,g.nf(tE,17),g.U(tE,Z7m(v,V,RL,t),19);case 19:a=tE.X;g.Rm(tE,18);break;case 17:BN=g.lj(tE);if(!(BN instanceof Error&&
BN.message==="No data for playlist")){if(BN instanceof Error&&BN.message==="Empty response body for playlist")v0(BN.message);else return pf="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",iU="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",BN instanceof g.I2&&BN.type==="QUOTA_EXCEEDED"&&(pf="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",iU="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),tE.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,pf,iU));tE.sB(18);
break}return g.U(tE,UDX(V,v.T,J,v.Z),18);case 18:if(!T)return tE.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));VY=[];IL=new Map;if((p=a)==null?0:p.length)for(y=g.n(a),w=y.next();!w.done;w=y.next())S=w.value,Z=S.offlineVideoData,ij=void 0,((ij=Z)==null?0:ij.videoId)&&IL.set(Z.videoId,Z);GX=new Map;om=[];if((u=C)==null?0:(dw=u.videos)==null?0:dw.length)for(VB=g.n(C.videos),Ys=VB.next();!Ys.done;Ys=VB.next())if(xs=Ys.value,WF=JSON.parse(g.bP(xs).entityId),X8=WF.videoId)IL.has(X8)?(GX.set(X8,
IL.get(X8)),IL.delete(X8)):om.push(X8);F2=Number(((CG=J.actionMetadata)==null?void 0:CG.priority)||0)+1;HW=g.n(IL.entries());for(X0=HW.next();!X0.done;X0=HW.next())tA=X0.value,Aq=g.n(tA),EA=Aq.next().value,Mh=Aq.next().value,kY=EA,QK=Mh,VY.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",kY,"mainVideoEntity",F2,H0,u6F(J,QK,V)));Rn=g.n(GX.entries());for(eK=Rn.next();!eK.done;eK=Rn.next())xb=eK.value,BJ=g.n(xb),mK=BJ.next().value,cu=BJ.next().value,NE=mK,Tj=cu,VY.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
NE,"mainVideoEntity",F2,H0,u6F(J,Tj,V)));iy=g.n(om);for(WM=iy.next();!WM.done;WM=iy.next())oI=WM.value,fM={playlistId:V},QZ={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:fM},VY.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",oI,"mainVideoEntity",0,H0,QZ));return tE.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,VY))}})},czU=function(v,J){var G,K,V,Y;
return g.m(function(r){switch(r.T){case 1:return G=Yk(J),g.nf(r,2),K=g.bP(J.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.U(r,mD8(v.T,J,v.Z,(V=J.actionMetadata)==null?void 0:(Y=V.offlineLoggingData)==null?void 0:Y.offlineDeleteReason),5):g.U(r,UDX(K,v.T,J,v.Z),6);case 6:if(!v.EB.C("woffle_enable_main_downloads_library")){r.sB(5);break}return g.U(r,k28(v.T,J.entityKey),5);case 5:g.Rm(r,3);break;case 2:return g.lj(r),r.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return r.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},Z7m=function(v,J,G,K){var V,Y,r,E,e,P,D;
return g.m(function(t){switch(t.T){case 1:return g.U(t,b9X([J]),2);case 2:return V=t.X,g.U(t,NzT(v,V[0],G,K),3);case 3:return Y=t.X,r=Y.mainPlaylistEntity,E=Y.c0i,P=wVN(r,(e=E)==null?void 0:e.avatar),g.nf(t,4),g.U(t,nZ(P),6);case 6:g.Rm(t,5);break;case 4:D=g.lj(t),D instanceof Error&&D.message==="Failed to fetch"&&v0(D.message);case 5:return t.return(V[0].videos)}})},NzT=function(v,J,G,K){var V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f;
return g.m(function(c){switch(c.T){case 1:V=Date.now().toString();G||(G=V);Y=J.videos;r=J.playlistId;E=[];e=[];if(Y)for(P=g.n(Y),D=P.next();!D.done;D=P.next()){t=D.value;B=t.offlineVideoData;if(!B||!B.videoId)throw v0("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");I=B.videoId;h={videoId:I,playlistId:r};R={id:g.j9(JSON.stringify(h),"mainPlaylistVideoEntity"),video:g.j9(I,"mainVideoEntity")};E.push(R);e.push(R.id)}L={key:g.j9(r,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:G,lastSyncedTimestampMillis:V};O={key:g.j9(r,"mainPlaylistEntity"),playlistId:r,videos:e,title:J.title,thumbnailStyleData:avN(J),visibility:AzF(J),downloadState:L.key};J.channel&&(x=J.channel.offlineChannelData,T=FDA(g.j9(r,"ytMainChannelEntity"),x),O.channelOwner=T.id);((f=O)==null?0:f.entityMetadata)?(O.entityMetadata.offlineLastModifiedTimestampSeconds=J.lastModifiedTimestamp,K&&(O.entityMetadata.nextAutoRefreshIntervalSeconds=String(K))):O&&(O.entityMetadata={nextAutoRefreshIntervalSeconds:K?
String(K):void 0,offlineLastModifiedTimestampSeconds:J.lastModifiedTimestamp});g.nf(c,2);return g.U(c,Ms(v.T,{mode:"readwrite",jX:!0},function(b){var M=ar(b,O,"mainPlaylistEntity"),Jw=ar(b,L,"mainPlaylistDownloadStateEntity");M=[M,Jw];Jw=g.n(E);for(var Kf=Jw.next();!Kf.done;Kf=Jw.next())M.push(ar(b,Kf.value,"mainPlaylistVideoEntity"));T&&M.push(ar(b,T,"ytMainChannelEntity"));return g.lK.all(M)}),4);
case 4:g.Rm(c,3);break;case 2:throw g.lj(c),v0("PES failure for playlist"),Error("PES failure for playlist");case 3:return c.return({mainPlaylistEntity:O,c0i:T,Bgh:E})}})},FDA=function(v,J){return{id:v,
channelId:J.channelId,title:J.title,avatar:J.thumbnail}},avN=function(v){var J=[],G=v.videos;
G&&G.length>0&&J.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:G[0].offlineVideoData.thumbnail}}});if((v=v.additionalMetadadatas)&&v.length>0)for(v=g.n(v),G=v.next();!G.done;G=v.next()){var K=G.value.offlineBundleItemPlaylistData,V=void 0;G=(V=K)==null?void 0:V.style;V=void 0;K={collageThumbnail:{coverThumbnail:(V=K)==null?void 0:V.coverThumbnail}};switch(G){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":J.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:K});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":J.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:K});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":J.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:K});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":J.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:K})}}return J},AzF=function(v){switch(v.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},u6F=function(v,J,G){J={offlineVideoData:J,
playlistId:G};if(v=g.N(v.actionMetadata,XY8))J.maximumDownloadQuality=v.maximumDownloadQuality;return{mainVideoEntityActionMetadata:J}},H7Y=function(v,J,G){this.T=v;
this.EB=J;this.Z=G},WDL=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h;
return g.m(function(R){switch(R.T){case 1:return G=Yk(J),K=g.bP(J.entityKey),V=K.entityId,Y=g.N(J.actionMetadata,Mp),E=!((r=Y)==null?0:r.playlistId),g.nf(R,2),g.U(R,MjN(v,V,void 0,(e=Y)==null?void 0:e.offlineVideoData,E),4);case 4:g.Rm(R,3);break;case 2:return P=g.lj(R),D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",P instanceof g.I2&&P.type==="QUOTA_EXCEEDED"&&(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
R.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,D,t));case 3:B=1;B=Number(((I=J.actionMetadata)==null?void 0:I.priority)||0)+1;var T=(T=g.N(J.actionMetadata,Mp))?{playbackDataActionMetadata:{maximumDownloadQuality:T.maximumDownloadQuality}}:void 0;h=US("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V,"playbackData",B,Q9A,T);return R.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,[h]))}})},C6m=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O;
return g.m(function(x){switch(x.T){case 1:return G=Yk(J),K=g.bP(J.entityKey),V=K.entityId,g.U(x,We(v.T,J.entityKey,"mainVideoEntity"),2);case 2:Y=x.X;if(!Y){r=void 0;x.sB(3);break}return g.U(x,We(v.T,Y.downloadState,"mainVideoDownloadStateEntity"),4);case 4:r=x.X;case 3:E=r;if(!Y||!E)return x.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));g.nf(x,5);return g.U(x,MjN(v,V,E.addedTimestampMillis,(P=g.N(J.actionMetadata,Mp))==null?void 0:P.offlineVideoData),7);case 7:D=1;D=Number(((t=
J.actionMetadata)==null?void 0:t.priority)||0)+1;e=US("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",V,"playbackData",D,Q9A);g.Rm(x,6);break;case 5:B=g.lj(x);if(!(B instanceof Error&&B.message==="No data")){if(B instanceof Error&&B.message==="Empty response body")v0(B.message);else return I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.I2&&B.type==="QUOTA_EXCEEDED"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),x.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,I,h));x.sB(6);break}return g.U(x,RR(v.T,V),9);case 9:R=x.X;T=g.N(J.actionMetadata,Mp);if(O=(L=T)==null?void 0:L.playlistId)R.playlistId=O;R.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.U(x,dJ(V,v.T,J,v.Z,R),6);case 6:return x.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,e?[e]:void 0))}})},b7S=function(v,J){var G,K,V,Y,r,E,e,P,D,t;
return g.m(function(B){switch(B.T){case 1:return G=Yk(J),g.nf(B,2),K=g.bP(J.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.U(B,mD8(v.T,J,v.Z,(D=J.actionMetadata)==null?void 0:(t=D.offlineLoggingData)==null?void 0:t.offlineDeleteReason),5):g.U(B,RR(v.T,K),6);case 6:V=B.X;Y=g.N(J.actionMetadata,Mp);if(E=(r=Y)==null?void 0:r.playlistId)V.playlistId=E;V.offlineDeleteReason=(e=J.actionMetadata)==null?void 0:(P=e.offlineLoggingData)==null?void 0:P.offlineDeleteReason;return g.U(B,dJ(K,v.T,J,v.Z,V),7);
case 7:if(!v.EB.C("woffle_enable_main_downloads_library")){B.sB(5);break}return g.U(B,k28(v.T,J.entityKey),5);case 5:g.Rm(B,3);break;case 2:return g.lj(B),B.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return B.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G))}})},MjN=function(v,J,G,K,V){var Y,r,E,e,P,D;
return g.m(function(t){switch(t.T){case 1:if(Y=K){t.sB(2);break}return g.U(t,CIN([J]),3);case 3:r=t.X,Y=r[0];case 2:return g.U(t,jyA(v,Y,G,V),4);case 4:E=t.X;e=E.mainVideoEntity;P=E.channelEntity;g.nf(t,5);var B=t8(e.thumbnail),I=t8(P.avatar);return g.U(t,nZ(B.concat(I)),7);case 7:g.Rm(t,0);break;case 5:D=g.lj(t),D instanceof Error&&D.message==="Failed to fetch"&&v0(D.message),g.zX(t)}})},jyA=function(v,J,G,K){var V,Y,r,E,e,P,D,t,B,I,h,R,T;
return g.m(function(L){switch(L.T){case 1:G||(G=Date.now().toString());Y=(V=J.channel)==null?void 0:V.offlineChannelData;r={id:g.j9(J.videoId,"ytMainChannelEntity"),channelId:Y.channelId,title:Y.title,avatar:Y.thumbnail};E={key:g.j9(J.videoId,"mainVideoDownloadStateEntity"),playbackData:g.j9(J.videoId,"playbackData"),addedTimestampMillis:G,videoDownloadContextEntity:g.j9(J.videoId,"videoDownloadContextEntity")};e={key:g.j9(J.videoId,"videoPlaybackPositionEntity"),videoId:J.videoId,lastPlaybackPositionSeconds:"0"};
v.EB.C("html5_offline_playback_position_sync")&&(P={playbackPosition:e.key});D=g.j9(J.videoId,"mainVideoEntity");t={key:D,videoId:J.videoId,title:J.title,thumbnail:J.thumbnail,localizedStrings:{viewCount:J.shortViewCountText},userState:P,lengthSeconds:J.lengthSeconds?Number(J.lengthSeconds):void 0,publishedTimestampMillis:J.publishedTimestamp?(Number(J.publishedTimestamp)*1E3).toString():void 0,formattedDescription:J.description,owner:r.id,downloadState:E.key};if(!v.EB.C("woffle_enable_main_downloads_library")||
!K){L.sB(2);break}return g.U(L,gDU(v.T,[D]),3);case 3:if(h=L.X)B=h.mainDownloadsLibraryEntity,I=h.mainDownloadsListEntity;case 2:return T=RLG,R={key:g.j9(J.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.cX(E,T,R),g.U(L,Ms(v.T,{mode:"readwrite",jX:!0},function(O){var x=ar(O,r,"ytMainChannelEntity"),f=ar(O,E,"mainVideoDownloadStateEntity"),c=ar(O,t,"mainVideoEntity");x=[x,f,c];v.EB.C("html5_offline_playback_position_sync")&&(f=ar(O,e,"videoPlaybackPositionEntity"),
x.push(f));B&&(f=ar(O,B,"mainDownloadsLibraryEntity"),x.push(f));I&&(f=ar(O,I,"mainDownloadsListEntity"),x.push(f));R&&(O=ar(O,R,"downloadStatusEntity"),x.push(O));return g.lK.all(x)}),4);
case 4:return L.return({mainVideoEntity:t,channelEntity:r})}})},i4m=function(v,J,G){this.T=v;
this.EB=J;this.Z=G},v5S=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf,j8,a,C;
return g.m(function(d){switch(d.T){case 1:return G=Yk(J),K=[],g.U(d,uG.getInstance(),2);case 2:V=d.X;if(!V){d.sB(3);break}return g.U(d,V.get("sdois"),4);case 4:return Y=d.X,g.U(d,(E=V)==null?void 0:E.get("lmqf"),5);case 5:r=d.X;case 3:g.nf(d,6);if(Y===void 0)throw Error("prefStorage or opt-in state is undefined");e=[];if(Y){d.sB(8);break}return g.U(d,uNA(v.T),9);case 9:e=d.X,e.reverse();case 8:if(!e.length){d.sB(10);break}P=g.n(e);D=P.next();case 11:if(D.done){d.sB(10);break}t=D.value;if(!t){d.sB(12);
break}B=g.bP(t).entityId;return g.U(d,RR(v.T,B),14);case 14:return I=d.X,I.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.U(d,dJ(B,v.T,{entityKey:t,actionType:J.actionType},v.Z,I),12);case 12:D=P.next();d.sB(11);break;case 10:return g.U(d,v2L(Y,(h=r)!=null?h:"SD"),16);case 16:return R=d.X,g.U(d,S_N(R),17);case 17:T=Z9F(R);if(!v.EB.C("woffle_enable_main_downloads_library")){d.sB(18);break}if(Y){d.sB(19);break}return g.U(d,k28(v.T,g.Ut),19);case 19:return g.U(d,XV_(v.T,[g.Ut]),18);
case 18:if((L=T)==null?0:L.length)for(O=g.n(T),x=O.next();!x.done;x=O.next())if(c=f=x.value,b=c.actionType,M=c.entityKey,Jw=c.actionMetadata,b&&M&&Jw&&!g.N(Jw,$4S)){b==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Jw.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Kf=g.N(f.actionMetadata,Mp))Kf.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",f.actionMetadata=Object.assign({},f.actionMetadata,{mainVideoEntityActionMetadata:Kf});K.push(f)}g.Rm(d,7);break;
case 6:return j8=g.lj(d),a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",j8 instanceof g.I2&&j8.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),d.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,a,C));case 7:return d.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,K))}})},JvN=function(){A8.apply(this,arguments);
this.N="mainVideoEntity"},GmY=function(v,J,G){J=J===void 0?43200:J;
G=G===void 0?!0:G;var K=K===void 0?!1:K;var V,Y,r;return g.m(function(E){switch(E.T){case 1:if(!v.j.B8())return E.return([]);V=[];g.nf(E,2);return g.U(E,iMU(J,G,K),4);case 4:V=E.X;g.Rm(E,3);break;case 2:Y=g.lj(E),Y instanceof Error&&Y.message==="No data"||Y instanceof Error&&Y.message==="Empty response body"&&v0(Y.message);case 3:return r=mRT(v,V,G,"mainPlaylistEntity"),E.return(r)}})},o58=function(v,J,G,K){K=K===void 0?!1:K;
var V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O;return g.m(function(x){switch(x.T){case 1:return V=[],g.U(x,$3U(),2);case 2:return(Y=x.X)||K?g.U(x,JST(J,G),3):x.return([]);case 3:r=x.X;if((E=r)==null||!E.length)return x.return([]);e={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};P=g.n(r);D=P.next();case 4:if(D.done){x.sB(6);break}B=t=D.value;I=B.actionType;h=B.entityKey;R=B.actionMetadata;if(!(I&&h&&R)||g.N(R,$4S)){x.sB(5);break}I==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(R.offlineLoggingData=
e);T=g.bP(h);L=T.entityId;return g.U(x,Fp(v,[L],"mainVideoEntity",I,R),8);case 8:O=x.X,V=V.concat(O);case 5:D=P.next();x.sB(4);break;case 6:return x.return(V)}})},KON=function(v,J){this.T=v;
this.Z=J},YEY=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L;
return g.m(function(O){switch(O.T){case 1:return G=Yk(J),K=g.bP(J.entityKey),V=K.entityId,Y=[],g.nf(O,2),g.U(O,Vw6(v,V),4);case 4:Y=O.X;if((r=Y)==null||!r.length){O.sB(5);break}return g.U(O,Fy8(v.T,J.entityKey),5);case 5:g.Rm(O,3);break;case 2:return E=g.lj(O),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.I2&&E.type==="QUOTA_EXCEEDED"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
O.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,e,P));case 3:return D=[],g.U(O,lWG(v.T,"musicTrack",Y),7);case 7:Y=O.X;if(Y.length)for(t=g.n(Y),B=t.next();!B.done;B=t.next())if(I=B.value,h=I.offlineVideoData,R=void 0,(R=h)==null?0:R.videoId)T=void 0,L=Number(((T=J.actionMetadata)==null?void 0:T.priority)||0)+1,D.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h.videoId,"musicTrack",L,Qd,LZ(J,h,V)));return O.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,D))}})},
rv8=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf,j8,a,C,d,A,cF,RL,BN,pf,iU,VY,IL,p,y,w,S,Z,ij,GX,om,u,dw,VB,Ys,xs,WF,X8,CG,F2,HW,X0,tA,Aq,EA,Mh;
return g.m(function(kY){switch(kY.T){case 1:return G=Yk(J),K=J.entityKey,V=g.bP(K).entityId,Y=[],r=!1,V==="!*$_ALL_ENTITIES_!*$"?(r=!0,g.U(kY,Cx(v.T,"musicAlbumRelease"),5)):g.U(kY,We(v.T,K,"musicAlbumRelease"),4);case 4:(E=kY.X)&&Y.push(E);kY.sB(3);break;case 5:Y=kY.X;case 3:if((e=Y)==null||!e.length)return kY.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));if(r){P=[];D=g.n(Y);for(t=D.next();!t.done;t=D.next())B=t.value,I=g.bP(B.id).entityId,P.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
I,"musicAlbumRelease",0,Qd));return kY.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,P))}h=[];R=Y[0];T=void 0;if(!R.downloadMetadata){kY.sB(6);break}return g.U(kY,We(v.T,R.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:L=kY.X,T=Number((x=(O=L)==null?void 0:O.addedTimestampMillis)!=null?x:"0")/1E3;case 6:return g.nf(kY,8),g.U(kY,Vw6(v,V,(f=T)==null?void 0:f.toString()),10);case 10:h=kY.X;g.Rm(kY,9);break;case 8:c=g.lj(kY);if(!(c instanceof Error&&c.message===
"No data")){if(c instanceof Error&&c.message==="Empty response body")v0(c.message);else return b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.I2&&c.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),kY.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,b,M));kY.sB(9);break}return g.U(kY,TH(V,"musicAlbumRelease",v.T,
J,v.Z),9);case 9:Jw=[];Kf=new Map;if((j8=h)==null?0:j8.length)for(a=g.n(h),C=a.next();!C.done;C=a.next())d=C.value,A=d.offlineVideoData,cF=void 0,((cF=A)==null?0:cF.videoId)&&Kf.set(A.videoId,A);RL=new Map;BN=[];if((pf=R)==null?0:(iU=pf.tracks)==null?0:iU.length)for(VY=g.n(R.tracks),IL=VY.next();!IL.done;IL=VY.next())if(p=IL.value,y=g.bP(p).entityId)Kf.has(y)?(RL.set(y,Kf.get(y)),Kf.delete(y)):BN.push(y);S=Number(((w=J.actionMetadata)==null?void 0:w.priority)||0)+1;Z=g.n(Kf.entries());for(ij=Z.next();!ij.done;ij=
Z.next())GX=ij.value,om=g.n(GX),u=om.next().value,dw=om.next().value,VB=u,Ys=dw,Jw.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",VB,"musicTrack",S,Qd,LZ(J,Ys)));xs=g.n(RL.entries());for(WF=xs.next();!WF.done;WF=xs.next())X8=WF.value,CG=g.n(X8),F2=CG.next().value,HW=CG.next().value,X0=F2,tA=HW,Jw.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",X0,"musicTrack",S,Qd,LZ(J,tA)));Aq=g.n(BN);for(EA=Aq.next();!EA.done;EA=Aq.next())Mh=EA.value,Jw.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Mh,
"musicTrack",0,Qd));return kY.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,Jw))}})},qEU=function(v,J){var G,K;
return g.m(function(V){switch(V.T){case 1:return G=Yk(J),g.nf(V,2),K=g.bP(J.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.U(V,pZ(v.T,J,v.Z),5):g.U(V,TH(K,"musicAlbumRelease",v.T,J,v.Z),6);case 6:return g.U(V,H9L(v.T,J.entityKey),5);case 5:g.Rm(V,3);break;case 2:return g.lj(V),V.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return V.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},Vw6=function(v,J,G){var K,V,Y;
return g.m(function(r){switch(r.T){case 1:return g.U(r,b9X([J]),2);case 2:return K=r.X,g.U(r,E5m(v,K[0],G),3);case 3:return V=r.X,Y=t8(V.thumbnailDetails),g.U(r,nZ(Y),4);case 4:return r.return(K[0].videos)}})},E5m=function(v,J,G){var K,V,Y,r,E,e,P,D,t,B,I,h,R,T;
return g.m(function(L){if(L.T==1){K=J.additionalMetadadatas;V=void 0;if(K&&K.length>0)for(Y=g.n(K),r=Y.next();!r.done;r=Y.next())if(E=r.value,E.offlineMusicPlaylistData){V=E.offlineMusicPlaylistData;break}e=J.playlistId;P=MdY(J);D=P.Aa;t=P.bu;B=G?(Number(G)*1E3).toString():Date.now().toString();I=J.lastModifiedTimestamp?(Number(J.lastModifiedTimestamp)*1E3).toString():"0";h={id:g.j9(e,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:t,lastModifiedTimestampMillis:I,addedTimestampMillis:B,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};R={id:g.j9(e,"musicAlbumRelease"),title:J.title,audioPlaylistId:e,trackCount:J.totalVideoCount,tracks:D,downloadMetadata:h.id};V&&(R.thumbnailDetails=(T=V.albumHqThumbnail)!=null?T:V.albumArtistThumbnail,R.artistDisplayName=V.albumArtistDisplayName,R.releaseDate=V.albumReleaseDate,R.contentRating={explicitType:V.albumReleaseExplicitType},R.releaseType=V.albumReleaseType);return g.U(L,Ms(v.T,{mode:"readwrite",jX:!0},function(O){var x=ar(O,R,"musicAlbumRelease");
O=ar(O,h,"musicAlbumReleaseDownloadMetadataEntity");return g.lK.all([x,O])}),2)}return L.return(R)})},eZG=function(v,J){this.T=v;
this.Z=J},D4o=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L;
return g.m(function(O){switch(O.T){case 1:return G=Yk(J),K=g.bP(J.entityKey),V=K.entityId,Y=[],g.nf(O,2),g.U(O,P9m(v,V),4);case 4:Y=O.X;if((r=Y)==null||!r.length){O.sB(5);break}return g.U(O,Fy8(v.T,J.entityKey),5);case 5:g.Rm(O,3);break;case 2:return E=g.lj(O),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.I2&&E.type==="QUOTA_EXCEEDED"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
O.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,e,P));case 3:return D=[],g.U(O,lWG(v.T,"musicTrack",Y),7);case 7:Y=O.X;if(Y.length)for(t=g.n(Y),B=t.next();!B.done;B=t.next())if(I=B.value,h=I.offlineVideoData,R=void 0,(R=h)==null?0:R.videoId)T=void 0,L=Number(((T=J.actionMetadata)==null?void 0:T.priority)||0)+1,D.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h.videoId,"musicTrack",L,W0,LZ(J,h,V)));return O.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,D))}})},
tw6=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf,j8,a,C,d,A,cF,RL,BN,pf,iU,VY,IL,p,y,w,S,Z,ij,GX,om,u,dw,VB,Ys,xs,WF,X8,CG,F2,HW,X0,tA,Aq,EA,Mh,kY,QK,Rn,eK,xb,BJ,mK,cu,NE,Tj,iy,WM;
return g.m(function(oI){switch(oI.T){case 1:return G=Yk(J),K=J.entityKey,V=g.bP(K).entityId,Y=[],r=!1,V==="!*$_ALL_ENTITIES_!*$"?(r=!0,g.U(oI,Cx(v.T,"musicPlaylist"),5)):g.U(oI,We(v.T,K,"musicPlaylist"),4);case 4:(E=oI.X)&&Y.push(E);oI.sB(3);break;case 5:Y=oI.X;case 3:if((e=Y)==null||!e.length)return oI.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));P=g.N(J.actionMetadata,QdF);t=(D=P)==null?void 0:D.autoSync;B=[];h=I=!0;R=!1;T=void 0;if(!r&&t===!1){oI.sB(6);break}g.nf(oI,7);return g.U(oI,
GlG(0,!!t,!0,Y),9);case 9:B=oI.X;g.Rm(oI,8);break;case 7:L=g.lj(oI);if(!(L instanceof Error&&L.message==="No data")){L instanceof Error&&L.message==="Empty response body"&&v0(L.message);oI.sB(8);break}return V==="!*$_ALL_ENTITIES_!*$"?g.U(oI,pZ(v.T,J,v.Z),8):g.U(oI,TH(V,"musicPlaylist",v.T,J,v.Z),8);case 8:if(!B.length||!r&&B[0].playlistId!==V)return oI.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));case 6:if(r){O=[];x=g.n(B);for(f=x.next();!f.done;f=x.next())c=f.value,c.upToDate||
t&&!c.shouldAutoSyncMetadata||!c.playlistId||(b={autoSync:t},O.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c.playlistId,"musicPlaylist",0,W0,{musicPlaylistEntityActionMetadata:b})));return oI.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,O))}B.length&&(M=B[0],R=!!M.upToDate,t&&(I=(Jw=M.shouldAutoSyncMetadata)!=null?Jw:!0,h=(Kf=M.shouldAutoSyncVideos)!=null?Kf:!0,M.checkInSeconds&&(T=M.checkInSeconds)));if(R||!I)return oI.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G));j8=[];a=Y[0];C=void 0;if(!a.downloadMetadata){oI.sB(15);break}return g.U(oI,We(v.T,a.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:d=oI.X,C=Number((cF=(A=d)==null?void 0:A.addedTimestampMillis)!=null?cF:"0")/1E3;case 15:return g.nf(oI,17),g.U(oI,P9m(v,V,(RL=C)==null?void 0:RL.toString(),T),19);case 19:j8=oI.X;g.Rm(oI,18);break;case 17:BN=g.lj(oI);if(!(BN instanceof Error&&BN.message==="No data")){if(BN instanceof Error&&BN.message==="Empty response body")v0(BN.message);else return pf=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",iU="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",BN instanceof g.I2&&BN.type==="QUOTA_EXCEEDED"&&(pf="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",iU="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),oI.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,pf,iU));oI.sB(18);break}return g.U(oI,TH(V,"musicPlaylist",v.T,J,v.Z),18);case 18:if(!h)return oI.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G));VY=[];IL=new Map;if((p=j8)==null?0:p.length)for(y=g.n(j8),w=y.next();!w.done;w=y.next())S=w.value,Z=S.offlineVideoData,ij=void 0,((ij=Z)==null?0:ij.videoId)&&IL.set(Z.videoId,Z);GX=new Map;om=[];if((u=a)==null?0:(dw=u.tracks)==null?0:dw.length)for(VB=g.n(a.tracks),Ys=VB.next();!Ys.done;Ys=VB.next())if(xs=Ys.value,WF=g.bP(xs).entityId)IL.has(WF)?(GX.set(WF,IL.get(WF)),IL.delete(WF)):om.push(WF);CG=Number(((X8=J.actionMetadata)==null?void 0:X8.priority)||0)+1;F2=g.n(IL.entries());for(HW=F2.next();!HW.done;HW=
F2.next())X0=HW.value,tA=g.n(X0),Aq=tA.next().value,EA=tA.next().value,Mh=Aq,kY=EA,VY.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Mh,"musicTrack",CG,W0,LZ(J,kY)));QK=g.n(GX.entries());for(Rn=QK.next();!Rn.done;Rn=QK.next())eK=Rn.value,xb=g.n(eK),BJ=xb.next().value,mK=xb.next().value,cu=BJ,NE=mK,VY.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",cu,"musicTrack",CG,W0,LZ(J,NE)));Tj=g.n(om);for(iy=Tj.next();!iy.done;iy=Tj.next())WM=iy.value,VY.push(US("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
WM,"musicTrack",0,W0));return oI.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,VY))}})},B_L=function(v,J){var G,K;
return g.m(function(V){switch(V.T){case 1:return G=Yk(J),g.nf(V,2),K=g.bP(J.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.U(V,pZ(v.T,J,v.Z),5):g.U(V,TH(K,"musicPlaylist",v.T,J,v.Z),6);case 6:return g.U(V,H9L(v.T,J.entityKey),5);case 5:g.Rm(V,3);break;case 2:return g.lj(V),V.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return V.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},P9m=function(v,J,G,K){var V,Y,r;
return g.m(function(E){switch(E.T){case 1:return g.U(E,b9X([J]),2);case 2:return V=E.X,g.U(E,ImS(v,V[0],G,K),3);case 3:return Y=E.X,r=t8(Y.thumbnailDetails),g.U(E,nZ(r),4);case 4:return E.return(V[0].videos)}})},ImS=function(v,J,G,K){var V,Y,r,E,e,P,D,t,B;
return g.m(function(I){return I.T==1?(V=J.playlistId,Y=MdY(J),r=Y.Aa,E=Y.bu,e=G?(Number(G)*1E3).toString():Date.now().toString(),P=J.lastModifiedTimestamp?(Number(J.lastModifiedTimestamp)*1E3).toString():"0",D={id:g.j9(V,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:E,lastModifiedTimestampMillis:P,addedTimestampMillis:e,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},t={id:g.j9(V,"musicPlaylist"),title:J.title,playlistId:V,thumbnailDetails:J.thumbnail,visibility:hZT(J),trackCount:J.totalVideoCount,
tracks:r,downloadMetadata:D.id},K&&(((B=t)==null?0:B.entityMetadata)?t.entityMetadata.nextAutoRefreshIntervalSeconds=String(K):t&&(t.entityMetadata={nextAutoRefreshIntervalSeconds:String(K)})),g.U(I,Ms(v.T,{mode:"readwrite",jX:!0},function(h){var R=ar(h,t,"musicPlaylist");h=ar(h,D,"musicPlaylistDownloadMetadataEntity");return g.lK.all([R,h])}),2)):I.return(t)})},hZT=function(v){switch(v.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},zZY=function(v,J){this.T=v;
this.Z=J},RZ8=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h;
return g.m(function(R){switch(R.T){case 1:return G=Yk(J),K=g.bP(J.entityKey),V=K.entityId,Y=g.N(J.actionMetadata,n5Y),g.nf(R,2),g.U(R,d48(v,V,void 0,(r=Y)==null?void 0:r.track,(E=Y)==null?void 0:E.albumRelease),4);case 4:if((e=Y)==null?0:e.playlistId){R.sB(5);break}return g.U(R,Fy8(v.T,J.entityKey),5);case 5:g.Rm(R,3);break;case 2:return P=g.lj(R),D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",P instanceof g.I2&&P.type==="QUOTA_EXCEEDED"&&
(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),R.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,D,t));case 3:I=Number(((B=J.actionMetadata)==null?void 0:B.priority)||0)+1;var T=(T=g.N(J.actionMetadata,n5Y))?{playbackDataActionMetadata:{maximumDownloadQuality:T.maximumDownloadQuality}}:void 0;h=US("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V,"playbackData",I,syT,T);return R.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G,[h]))}})},lmm=function(v,J){var G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T;
return g.m(function(L){switch(L.T){case 1:return G=Yk(J),K=g.bP(J.entityKey),V=K.entityId,g.U(L,We(v.T,J.entityKey,"musicTrack"),2);case 2:Y=L.X;if(!Y){r=void 0;L.sB(3);break}return g.U(L,We(v.T,Y.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:r=L.X;case 3:E=r;if(!Y||!E)return L.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G));P=g.N(J.actionMetadata,n5Y);g.nf(L,5);return g.U(L,d48(v,V,E.addedTimestampMillis,(D=P)==null?void 0:D.track,(t=P)==null?void 0:t.albumRelease),
7);case 7:I=Number(((B=J.actionMetadata)==null?void 0:B.priority)||0)+1;e=US("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",V,"playbackData",I,syT);g.Rm(L,6);break;case 5:h=g.lj(L);if(!(h instanceof Error&&h.message==="No data")){if(h instanceof Error&&h.message==="Empty response body")v0(h.message);else return R="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.I2&&h.type==="QUOTA_EXCEEDED"&&(R="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),L.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,R,T));L.sB(6);break}return g.U(L,lO(V,v.T,J,v.Z),6);case 6:return L.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",G,e?[e]:void 0))}})},T_L=function(v,J){var G,K;
return g.m(function(V){switch(V.T){case 1:return G=Yk(J),g.nf(V,2),K=g.bP(J.entityKey).entityId,K==="!*$_ALL_ENTITIES_!*$"?g.U(V,pZ(v.T,J,v.Z),5):g.U(V,lO(K,v.T,J,v.Z),6);case 6:return g.U(V,H9L(v.T,J.entityKey),5);case 5:g.Rm(V,3);break;case 2:return g.lj(V),V.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",G,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return V.return(new xk("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
G))}})},d48=function(v,J,G,K,V){var Y,r,E,e,P,D;
return g.m(function(t){switch(t.T){case 1:if(Y=K){t.sB(2);break}return g.U(t,CIN([J]),3);case 3:r=t.X,E=r[0],Y=AUX(E);case 2:return g.U(t,p$m(v,Y,J,V,G),4);case 4:e=t.X;P=e.musicTrackEntity;D=e.P5;var B=t8(P.thumbnailDetails),I=[];D&&(I=t8(D.thumbnailDetails));return g.U(t,nZ(B.concat(I)),0)}})},p$m=function(v,J,G,K,V){var Y;
return g.m(function(r){return r.T==1?(V||(V=Date.now().toString()),Y={id:g.j9(G,"musicTrackDownloadMetadataEntity"),playbackData:g.j9(G,"playbackData"),addedTimestampMillis:V,videoDownloadContextEntity:g.j9(G,"videoDownloadContextEntity")},K&&(J.albumRelease=K.id),g.U(r,Ms(v.T,{mode:"readwrite",jX:!0},function(E){var e=[],P=ar(E,Y,"musicTrackDownloadMetadataEntity");e.push(P);P=ar(E,J,"musicTrack");e.push(P);K&&(E=ar(E,K,"musicAlbumRelease"),e.push(E));return g.lK.all(e)}),2)):r.T!=3?g.U(r,eM(G,"musicTrackDownloadMetadataEntity",
v.T,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):r.return({musicTrackEntity:J,
P5:K})})},CZ=function(){A8.apply(this,arguments);
this.N="musicTrack"},LOm=function(v,J,G){J=J===void 0?43200:J;
G=G===void 0?!0:G;var K=K===void 0?!1:K;var V,Y;return g.m(function(r){switch(r.T){case 1:if(!v.j.B8())return r.return([]);V=[];g.nf(r,2);return g.U(r,GlG(J,G,K),4);case 4:V=r.X;g.Rm(r,3);break;case 2:g.lj(r);case 3:return Y=mRT(v,V,G,"musicPlaylist"),r.return(Y)}})},yvF=function(){g.YQ.apply(this,arguments);
var v=this;this.events=new g.Zs(this);this.EB=this.player.B();this.cO={SXB:function(){return v.T},
d4:function(){return v.d4()},
G3:function(J){return v.G3(J)}}},w$A=function(v){var J;
v=g.N((J=v.getWatchNextResponse())==null?void 0:J.currentVideoEndpoint,g.ig);if(v==null?0:v.playlistId)var G=v.playlistId;return G},O4L=function(v,J){var G,K,V,Y;
return g.m(function(r){if(r.T==1){G=J.clientPlaybackNonce;K={cpn:G,offlineSourceVisualElement:g.lW(J.Mr||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};J.X&&(K.videoFmt=Number(J.X.itag));J.L&&(K.audioFmt=Number(J.L.itag));if((V=w$A(J))&&J.videoId){var E=J.videoId;E=V!=="PPSV"?Promise.resolve(!1):v.T.Pk(E);r=g.U(r,E,3)}else r=r.sB(2);return r}r.T!=2&&(Y=r.X)&&(K.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");v.X=G;g.ql("offlinePlaybackStarted",K);g.zX(r)})};
g.wr.prototype.HT=g.rw(51,function(v){return this.app.HT(v)});
g.eo.prototype.HT=g.rw(50,function(v){return g.v9s(this,9,v)});
g.z(fx,Sq);g.qL.Object.defineProperties(fx.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.T.entityMetadata},
set:function(v){this.T.entityMetadata=v}}});
g.z(lZo,fx);lZo.prototype.X=function(){return[]};
g.z(TWX,fx);TWX.prototype.X=function(){return[]};
g.z(puY,fx);puY.prototype.X=function(){return[]};
g.z(LV8,fx);LV8.prototype.X=function(){return[]};
g.z(yC8,fx);yC8.prototype.X=function(){var v=[];this.T.alternateChannel&&v.push(this.T.alternateChannel);this.T.alternateChannelList&&v.push.apply(v,g.l(this.T.alternateChannelList));this.T.oneofChannelEntity&&v.push(this.T.oneofChannelEntity);return[].concat(g.l(new Set(v)))};
g.z(wuU,fx);wuU.prototype.X=function(){var v=[];this.T.entryCollection&&v.push(this.T.entryCollection);return[].concat(g.l(new Set(v)))};
g.z(OuT,Sq);OuT.prototype.X=function(){var v=[];this.T.video&&v.push(this.T.video);return[].concat(g.l(new Set(v)))};
g.z(UE8,fx);UE8.prototype.X=function(){var v=[];this.T.parentPlaylist&&v.push(this.T.parentPlaylist);if(this.T.entries)for(var J=g.n(this.T.entries),G=J.next();!G.done;G=J.next())v.push.apply(v,g.l((new OuT(G.value)).X()));return[].concat(g.l(new Set(v)))};
g.z(xE8,fx);xE8.prototype.X=function(){var v=[];this.T.descriptionEntity&&v.push(this.T.descriptionEntity);this.T.creators&&v.push.apply(v,g.l(this.T.creators));this.T.theBiggestFan&&v.push(this.T.theBiggestFan);return[].concat(g.l(new Set(v)))};
g.z(mE8,fx);mE8.prototype.X=function(){return[]};
g.z(SnY,fx);SnY.prototype.X=function(){return[]};
g.z(fZA,fx);fZA.prototype.X=function(){return[]};
g.z(ZuG,fx);ZuG.prototype.X=function(){return[]};
g.z(ulL,fx);ulL.prototype.X=function(){return[]};
g.z(gaX,fx);gaX.prototype.X=function(){return[]};
g.z(XuY,fx);XuY.prototype.X=function(){return[]};
g.z(kOS,fx);kOS.prototype.X=function(){return[]};
g.z(cCF,fx);cCF.prototype.X=function(){return[]};
g.z(NW8,fx);NW8.prototype.X=function(){var v=[];this.T.downloadsList&&v.push(this.T.downloadsList);this.T.smartDownloadsList&&v.push(this.T.smartDownloadsList);this.T.recommendedDownloadsList&&v.push(this.T.recommendedDownloadsList);this.T.refresh&&v.push(this.T.refresh);return[].concat(g.l(new Set(v)))};
g.z(aZU,Sq);aZU.prototype.X=function(){var v=[];this.T.video&&v.push(this.T.video);this.T.playlist&&v.push(this.T.playlist);this.T.videoItem&&v.push(this.T.videoItem);this.T.playlistItem&&v.push(this.T.playlistItem);return[].concat(g.l(new Set(v)))};
g.z(ACm,fx);ACm.prototype.X=function(){var v=[];this.T.refresh&&v.push(this.T.refresh);if(this.T.downloads)for(var J=g.n(this.T.downloads),G=J.next();!G.done;G=J.next())v.push.apply(v,g.l((new aZU(G.value)).X()));return[].concat(g.l(new Set(v)))};
g.z(FVm,fx);FVm.prototype.X=function(){var v=[];this.T.localImageEntities&&v.push.apply(v,g.l(this.T.localImageEntities));return[].concat(g.l(new Set(v)))};
g.z(HuA,fx);HuA.prototype.X=function(){var v=[];this.T.playbackData&&v.push(this.T.playbackData);this.T.localImageEntities&&v.push.apply(v,g.l(this.T.localImageEntities));this.T.videoDownloadContextEntity&&v.push(this.T.videoDownloadContextEntity);return[].concat(g.l(new Set(v)))};
g.z(MTU,fx);MTU.prototype.X=function(){return[]};
g.z(QW6,fx);QW6.prototype.X=function(){var v=[];this.T.fakeChildren&&v.push.apply(v,g.l(this.T.fakeChildren));return[].concat(g.l(new Set(v)))};
g.z(WVT,fx);WVT.prototype.X=function(){var v=[];this.T.video&&v.push(this.T.video);this.T.playbackData&&v.push(this.T.playbackData);this.T.offlineVideoPolicy&&v.push(this.T.offlineVideoPolicy);return[].concat(g.l(new Set(v)))};
g.z(CLS,fx);CLS.prototype.X=function(){return[]};
g.z(buY,fx);buY.prototype.X=function(){var v=[];this.T.channelOwner&&v.push(this.T.channelOwner);this.T.videos&&v.push.apply(v,g.l(this.T.videos));this.T.collaboratorChannels&&v.push.apply(v,g.l(this.T.collaboratorChannels));this.T.downloadState&&v.push(this.T.downloadState);this.T.refresh&&v.push(this.T.refresh);return[].concat(g.l(new Set(v)))};
g.z(jlG,fx);jlG.prototype.X=function(){var v=[];this.T.video&&v.push(this.T.video);this.T.channelContributor&&v.push(this.T.channelContributor);return[].concat(g.l(new Set(v)))};
g.z(iO_,Sq);iO_.prototype.X=function(){var v=[];this.T.localImageEntities&&v.push.apply(v,g.l(this.T.localImageEntities));this.T.videoDownloadContextEntity&&v.push(this.T.videoDownloadContextEntity);return[].concat(g.l(new Set(v)))};
g.z($fo,Sq);$fo.prototype.X=function(){var v=[];this.T.recommendedVideoMetadata&&v.push.apply(v,g.l((new iO_(this.T.recommendedVideoMetadata)).X()));return[].concat(g.l(new Set(v)))};
g.z(vKA,Sq);vKA.prototype.X=function(){var v=[];this.T.playbackPosition&&v.push(this.T.playbackPosition);return[].concat(g.l(new Set(v)))};
g.z(JIA,fx);JIA.prototype.X=function(){var v=[];this.T.owner&&v.push(this.T.owner);this.T.downloadState&&v.push(this.T.downloadState);this.T.userState&&v.push.apply(v,g.l((new vKA(this.T.userState)).X()));this.T.additionalMetadata&&v.push.apply(v,g.l((new $fo(this.T.additionalMetadata)).X()));return[].concat(g.l(new Set(v)))};
g.z(GU_,fx);GU_.prototype.X=function(){var v=[];this.T.userChannelDetails&&v.push(this.T.userChannelDetails);return[].concat(g.l(new Set(v)))};
g.z(oKS,fx);oKS.prototype.X=function(){var v=[];this.T.channelOwner&&v.push(this.T.channelOwner);this.T.playbackPosition&&v.push(this.T.playbackPosition);this.T.localImageEntities&&v.push.apply(v,g.l(this.T.localImageEntities));this.T.downloadStatus&&v.push(this.T.downloadStatus);return[].concat(g.l(new Set(v)))};
g.z(K4o,fx);K4o.prototype.X=function(){return[]};
g.z(VzF,fx);VzF.prototype.X=function(){return[]};
g.z(YX6,fx);YX6.prototype.X=function(){return[]};
g.z(rI_,fx);rI_.prototype.X=function(){return[]};
g.z(qXF,fx);qXF.prototype.X=function(){return[]};
g.z(EKL,fx);EKL.prototype.X=function(){return[]};
g.z(e9G,fx);e9G.prototype.X=function(){return[]};
g.z(Pq8,fx);Pq8.prototype.X=function(){return[]};
g.z(DfF,fx);DfF.prototype.X=function(){return[]};
g.z(tzG,fx);tzG.prototype.X=function(){return[]};
g.z(BnX,fx);BnX.prototype.X=function(){return[]};
g.z(IQ_,fx);IQ_.prototype.X=function(){var v=[];this.T.trackDownloadMetadatas&&v.push.apply(v,g.l(this.T.trackDownloadMetadatas));return[].concat(g.l(new Set(v)))};
g.z(h9X,fx);
h9X.prototype.X=function(){var v=[];this.T.downloadedTracks&&v.push.apply(v,g.l(this.T.downloadedTracks));this.T.smartDownloadedTracks&&v.push.apply(v,g.l(this.T.smartDownloadedTracks));this.T.downloadedEpisodes&&v.push.apply(v,g.l(this.T.downloadedEpisodes));this.T.downloadedAlbumReleases&&v.push.apply(v,g.l(this.T.downloadedAlbumReleases));this.T.smartDownloadedAlbumReleases&&v.push.apply(v,g.l(this.T.smartDownloadedAlbumReleases));this.T.downloadedPlaylists&&v.push.apply(v,g.l(this.T.downloadedPlaylists));this.T.smartDownloadedPlaylists&&
v.push.apply(v,g.l(this.T.smartDownloadedPlaylists));this.T.metadataOnlyTracks&&v.push.apply(v,g.l(this.T.metadataOnlyTracks));return[].concat(g.l(new Set(v)))};
g.z(z98,fx);z98.prototype.X=function(){var v=[];this.T.trackDownloadMetadatas&&v.push.apply(v,g.l(this.T.trackDownloadMetadatas));return[].concat(g.l(new Set(v)))};
g.z(nKS,fx);nKS.prototype.X=function(){var v=[];this.T.playbackData&&v.push(this.T.playbackData);this.T.localImageEntities&&v.push.apply(v,g.l(this.T.localImageEntities));this.T.videoDownloadContextEntity&&v.push(this.T.videoDownloadContextEntity);return[].concat(g.l(new Set(v)))};
g.z(dfX,fx);dfX.prototype.X=function(){var v=[];this.T.musicLibraryStatusEntity&&v.push(this.T.musicLibraryStatusEntity);this.T.primaryArtists&&v.push.apply(v,g.l(this.T.primaryArtists));this.T.details&&v.push(this.T.details);this.T.userDetails&&v.push(this.T.userDetails);this.T.tracks&&v.push.apply(v,g.l(this.T.tracks));this.T.share&&v.push(this.T.share);this.T.downloadMetadata&&v.push(this.T.downloadMetadata);this.T.refresh&&v.push(this.T.refresh);return[].concat(g.l(new Set(v)))};
g.z(slX,fx);slX.prototype.X=function(){var v=[];this.T.albumRelease&&v.push(this.T.albumRelease);this.T.tracks&&v.push.apply(v,g.l(this.T.tracks));return[].concat(g.l(new Set(v)))};
g.z(R9G,fx);R9G.prototype.X=function(){var v=[];this.T.albumRelease&&v.push(this.T.albumRelease);return[].concat(g.l(new Set(v)))};
g.z(lQ8,fx);lQ8.prototype.X=function(){var v=[];this.T.details&&v.push(this.T.details);this.T.userDetails&&v.push(this.T.userDetails);return[].concat(g.l(new Set(v)))};
g.z(TnS,fx);TnS.prototype.X=function(){var v=[];this.T.parentArtist&&v.push(this.T.parentArtist);return[].concat(g.l(new Set(v)))};
g.z(p_T,fx);p_T.prototype.X=function(){var v=[];this.T.parentArtist&&v.push(this.T.parentArtist);return[].concat(g.l(new Set(v)))};
g.z(L4N,fx);L4N.prototype.X=function(){return[]};
g.z(yIT,fx);yIT.prototype.X=function(){return[]};
g.z(w_6,Sq);w_6.prototype.X=function(){var v=[];this.T.creatorEntity&&v.push(this.T.creatorEntity);return[].concat(g.l(new Set(v)))};
g.z(OOG,fx);
OOG.prototype.X=function(){var v=[];this.T.tracks&&v.push.apply(v,g.l(this.T.tracks));this.T.refresh&&v.push(this.T.refresh);this.T.musicLibraryStatusEntity&&v.push(this.T.musicLibraryStatusEntity);this.T.details&&v.push(this.T.details);this.T.downloadMetadata&&v.push(this.T.downloadMetadata);this.T.sideloadMetadata&&v.push(this.T.sideloadMetadata);this.T.userDetails&&v.push(this.T.userDetails);this.T.entryCollection&&v.push(this.T.entryCollection);this.T.share&&v.push(this.T.share);this.T.podcastShowAdditionalMetadata&&v.push.apply(v,
g.l((new w_6(this.T.podcastShowAdditionalMetadata)).X()));return[].concat(g.l(new Set(v)))};
g.z(UfN,fx);UfN.prototype.X=function(){return[]};
g.z(xfF,fx);
xfF.prototype.X=function(){var v=[];this.T.musicLibraryStatusEntity&&v.push(this.T.musicLibraryStatusEntity);this.T.artists&&v.push.apply(v,g.l(this.T.artists));this.T.audioModeVersion&&v.push(this.T.audioModeVersion);this.T.videoModeVersion&&v.push(this.T.videoModeVersion);this.T.userDetails&&v.push(this.T.userDetails);this.T.details&&v.push(this.T.details);this.T.albumRelease&&v.push(this.T.albumRelease);this.T.share&&v.push(this.T.share);this.T.libraryEdit&&v.push(this.T.libraryEdit);this.T.downloadMetadata&&
v.push(this.T.downloadMetadata);this.T.playbackPosition&&v.push(this.T.playbackPosition);this.T.lyrics&&v.push(this.T.lyrics);return[].concat(g.l(new Set(v)))};
g.z(mfF,fx);mfF.prototype.X=function(){var v=[];this.T.parentTrack&&v.push(this.T.parentTrack);return[].concat(g.l(new Set(v)))};
g.z(SX8,fx);SX8.prototype.X=function(){var v=[];this.T.parentTrack&&v.push(this.T.parentTrack);return[].concat(g.l(new Set(v)))};
g.z(fQ8,fx);fQ8.prototype.X=function(){return[]};
g.z(ZO_,fx);ZO_.prototype.X=function(){return[]};
g.z(u_G,fx);u_G.prototype.X=function(){return[]};
g.z(gKG,fx);gKG.prototype.X=function(){return[]};
g.z(X_F,fx);X_F.prototype.X=function(){var v=[];this.T.transfer&&v.push(this.T.transfer);this.T.adsPlaybackData&&v.push.apply(v,g.l(this.T.adsPlaybackData));this.T.drmLicense&&v.push(this.T.drmLicense);this.T.offlineVideoPolicy&&v.push(this.T.offlineVideoPolicy);this.T.videoDownloadContextEntity&&v.push(this.T.videoDownloadContextEntity);return[].concat(g.l(new Set(v)))};
g.z(kUo,fx);kUo.prototype.X=function(){return[]};
g.z(cIY,fx);cIY.prototype.X=function(){var v=[];this.T.offlineVideoStreams&&v.push.apply(v,g.l(this.T.offlineVideoStreams));this.T.captionTrack&&v.push.apply(v,g.l(this.T.captionTrack));return[].concat(g.l(new Set(v)))};
g.z(Nno,fx);Nno.prototype.X=function(){return[]};
g.z(aQF,fx);aQF.prototype.X=function(){return[]};
g.z(AI6,fx);AI6.prototype.X=function(){return[]};
g.z(F4A,fx);F4A.prototype.X=function(){return[]};
g.z(HOT,fx);HOT.prototype.X=function(){return[]};
g.z(Mzo,fx);Mzo.prototype.X=function(){return[]};
g.z(Ql8,fx);Ql8.prototype.X=function(){return[]};
g.z(W4m,fx);W4m.prototype.X=function(){return[]};
g.z(Cq8,fx);Cq8.prototype.X=function(){return[]};
g.z(bOL,fx);bOL.prototype.X=function(){return[]};
g.z(jY_,fx);jY_.prototype.X=function(){return[]};
g.z(iLU,fx);iLU.prototype.X=function(){return[]};
g.z($KX,fx);$KX.prototype.X=function(){return[]};
g.z(v3o,fx);v3o.prototype.X=function(){return[]};
g.z(J4T,fx);J4T.prototype.X=function(){return[]};
g.z(GKG,fx);GKG.prototype.X=function(){return[]};
g.z(o3A,fx);o3A.prototype.X=function(){return[]};
g.z(KjS,fx);KjS.prototype.X=function(){return[]};
g.z(VpL,fx);VpL.prototype.X=function(){return[]};
g.z(YGX,fx);YGX.prototype.X=function(){return[]};
var o2Y=["browse","music/browse","unplugged/browse"],q5_=["offline/playlist_sync_check"],WyY=["offline"],KGG=["offline/offline_video_playback_position_sync"],Y5N=["offline/get_playback_data_entity"],Zj;uG.getInstance=function(){return g.m(function(v){return v.return(new Promise(function(J){g.jg().then(function(G){G?(uG.instance||(uG.instance=new uG(G)),J(uG.instance)):J(void 0)})}))})};
uG.prototype.get=function(v){var J=this,G,K,V;return g.m(function(Y){if(Y.T==1)return g.U(Y,eq_(J.token),2);if(Y.T!=3)return G=Y.X,g.U(Y,G.get("prefs",v),3);K=Y.X;if(!K)return Y.return();V=(0,g.yR)();return K.expirationTimestampMs<=V?Y.return():Y.return(K.value)})};
uG.prototype.set=function(v,J,G){G=G===void 0?31536E3:G;var K=this,V,Y,r;return g.m(function(E){if(E.T==1)return V=(0,g.yR)(),Y={key:v,value:J,expirationTimestampMs:V+G*1E3},g.U(E,eq_(K.token),2);r=E.X;return g.U(E,g.SQ(r,"prefs",Y),0)})};
uG.prototype.remove=function(v){var J=this,G;return g.m(function(K){if(K.T==1)return g.U(K,eq_(J.token),2);G=K.X;return g.U(K,G.delete("prefs",v),0)})};
g.z(gY,g.Mk);g.z(XO,ItS);XO.prototype.Z=function(v,J){J=zq8(J);v=(new TextEncoder).encode(JSON.stringify(v));return this.T.encrypt(v,J)};
XO.prototype.X=function(v,J){if(!(v instanceof Uint8Array))throw PtF(1);var G=new TextDecoder;J=zq8(J);v=this.T.decrypt(v,J);return JSON.parse(G.decode(v))};
var n3X={accountLinkStatusEntity:fZA,booleanEntity:puY,buttonEntity:$KX,captionTrack:fQ8,channelHandle:lZo,commerceAcquisitionClientPayloadEntity:J4T,commerceCartListEntity:GKG,contextNoteFeedEntityPayload:TWX,continuationTokenEntity:CLS,downloadQualityPickerEntity:XuY,downloadsPageRefreshTokenEntity:cCF,downloadsPageViewConfigurationEntity:K4o,downloadStatusEntity:kOS,dismissState:Ql8,sfvAudioItemCurrentlyPlayingEntity:F4A,emojiFountainDataEntity:jY_,emojiCustomizationSetEntity:bOL,fakeChannel:yC8,
fakePlaylist:wuU,fakePlaylistEntryCollection:UE8,fakeVideo:xE8,fakeVideoDescription:mE8,featuredProductsEntity:DfF,flowStateEntity:SnY,iconBadgeEntity:o3A,interstitialInteractionStateEntity:ulL,likeButtonAnimationEntity:VzF,liveChatPollStateEntity:gaX,liveViewerLeaderboardChatEntryPointStateEntity:aQF,liveViewerLeaderboardPointsEntity:AI6,liveReactionsDataEntity:iLU,logoEntity:ZuG,macroMarkerEntity:YX6,mainDownloadsLibraryEntity:NW8,mainDownloadsListEntity:ACm,mainPlaylistDownloadStateEntity:FVm,
mainPlaylistEntity:buY,mainPlaylistVideoEntity:jlG,mainVideoDownloadStateEntity:HuA,mainVideoEntity:JIA,markersEngagementPanelSyncEntity:rI_,markersVisibilityOverrideEntity:qXF,musicAlbumReleaseDetail:slX,musicAlbumReleaseDownloadMetadataEntity:IQ_,musicAlbumRelease:dfX,musicAlbumReleaseUserDetail:R9G,musicArtistDetail:TnS,musicArtist:lQ8,musicArtistUserDetail:p_T,musicDownloadsLibraryEntity:h9X,musicLibraryEdit:L4N,musicLibraryStatusEntity:yIT,musicPlaylist:OOG,musicPlaylistDownloadMetadataEntity:z98,
musicShare:UfN,musicTrackDetail:mfF,musicTrackDownloadMetadataEntity:nKS,musicTrack:xfF,musicTrackUserDetail:SX8,offlineOrchestrationActionWrapperEntity:ZO_,offlineVideoPolicy:u_G,offlineVideoStreams:gKG,offlineabilityEntity:MTU,orchestrationWebSamplingEntity:QW6,pageHeaderEntity:W4m,pdpStateEntity:KjS,pinnedProductEntity:tzG,playbackData:X_F,playerStateEntity:EKL,quantityIncrementerEntity:VpL,refresh:kUo,saveToPlaylistListEntity:HOT,settingEntity:Mzo,stringEntity:LV8,suggestedFeedbackChipStateEntity:e9G,
transfer:cIY,trendingOfferEntity:BnX,videoDownloadContextEntity:Nno,videoOverviewAsyncDataEntity:YGX,videoPlaybackPositionEntity:v3o,votingEntity:Cq8,ytMainChannelEntity:GU_,youchatPendingResponseEntity:Pq8,ytMainDownloadedVideoEntity:WVT,ytMainVideoEntity:oKS};g.z(FO,ItS);FO.prototype.Z=function(v){return v};
FO.prototype.X=function(v){if(v instanceof Uint8Array)throw PtF(0);return v};
g.z(He,g.X);He.prototype.observe=function(v){var J=this;this.observers.push(v);return function(){var G=J.observers.indexOf(v);G>=0&&J.observers.splice(G,1)}};
He.prototype.X=function(v){SG_(this,v.data)};
He.prototype.X4=function(){this.channel.close()};
var XjU,fW6=new g.L4("elementsCommand");var sS=new g.L4("entityBatchUpdate");var RLG=new g.L4("downloadStatusEntity");var XY8=new g.L4("mainPlaylistEntityActionMetadata");var Mp=new g.L4("mainVideoEntityActionMetadata");var QdF=new g.L4("musicPlaylistEntityActionMetadata");var n5Y=new g.L4("musicTrackEntityActionMetadata");var $4S=new g.L4("localImageEntityActionMetadata");var mC=new g.L4("playbackDataActionMetadata");var ZMY=new g.L4("transferEntityActionMetadata");var d3Y=new g.L4("videoPlaybackPositionEntityActionMetadata");var $D_;new g.w5;new g.w5;KyT.prototype.request=function(v,J,G){J=J===void 0?{}:J;return this.locks.request(v,J,function(K){return G(K)})};var $k=g.X2.caches,iO,EDY;jM.prototype.open=function(v){return $k.open(rUU(v))};
jM.prototype.has=function(v){return $k.has(rUU(v))};
jM.prototype.delete=function(v){return $k.delete(rUU(v))};
jM.prototype.match=function(v,J){var G=this,K,V,Y,r,E,e;return g.m(function(P){switch(P.T){case 1:return g.U(P,G.keys(),2);case 2:K=P.X,V=g.n(K),Y=V.next();case 3:if(Y.done){P.sB(5);break}r=Y.value;return g.U(P,G.open(r),6);case 6:return E=P.X,g.U(P,E.match(v,J),7);case 7:if(e=P.X)return P.return(e);Y=V.next();P.sB(3);break;case 5:return P.return()}})};
g.z(Y_T,jM);Y_T.prototype.keys=function(){var v,J,G,K,V,Y,r,E,e;return g.m(function(P){if(P.T==1)return v=[],J=g.QC("CacheStorage keys"),g.U(P,$k.keys(),2);G=P.X;K=g.n(G);for(V=K.next();!V.done;V=K.next()){Y=V.value;var D=Y.indexOf(":");r=D===-1?{EO:Y}:{EO:Y.substring(0,D),datasyncId:Y.substring(D+1)};E=r.EO;e=r.datasyncId;e===J&&v.push(E)}return P.return(v)})};g.z(J8,g.X);J8.prototype.Z=function(v){this.api.lw("onOfflineOperationFailure",v.data)};
J8.prototype.L=function(v){this.api.publish("offlinetransferpause",v.data)};
J8.prototype.X4=function(){var v;(v=this.T)==null||v.close();var J;(J=this.X)==null||J.close()};DDN.prototype.ML=function(){this.T&&oR(this)};
DDN.prototype.Rl=function(){this.X&&this.X.resolve();this.Z=this.T=!1;this.N()};var j9L=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var xDN="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var aWT="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.z(ewG,OS);ewG.prototype.X=function(v){return rJ(v)?tyX(this,v):qp(v)?hw8(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};g.z(zw6,OS);zw6.prototype.X=function(v){return qp(v)?n28(this,v):sdo(v)?sJ8(this,v):ES(v)?RwS(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};g.q=l$m.prototype;g.q.kSb=function(v){var J=this,G,K,V,Y;return g.m(function(r){if(!g.H(v.state,128))return r.sB(0);G=v.state.c8;var E=(K=G)==null?void 0:K.errorCode,e=(V=G)==null?void 0:V.LI;Y=E==="net.connect"&&e===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(E==null?0:E.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.U(r,J.pU(J.player.getVideoData().videoId,Y),0)})};
g.q.pU=function(v,J){var G=this;return g.m(function(K){if(K.T==1){if(G.X)return K.return();G.X=!0;return J==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(ZA(G,v,!1,!0),K.sB(0)):g.U(K,fZ(G,v),3)}g.xg(v,4);return g.U(K,G.T.pU(J),0)})};
g.q.xT=function(v){v.status===2?(v.status!==this.Z&&(nfU(this.T),g.xg(v.videoId,2)),v.Ch&&TzT(this.T,v.videoId,v.Ch)):v.status===4?(fZ(this,v.videoId),this.pU(v.videoId,v.nf?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):v.status===1&&lv8(this.T);this.Z=v.status;this.api.lw("localmediachange",{videoId:v.videoId,status:v.status})};
g.q.RF=function(){var v=this,J;return g.m(function(G){if(G.T==1){if(v.X)return G.return();v.X=!0;J=v.player.getVideoData().videoId;return g.U(G,fZ(v,J),2)}return g.U(G,v.T.RF(),0)})};
g.q.EG=function(v){switch(v){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.q.C=function(v){return this.api.B().C(v)};g.z(U3G,OS);U3G.prototype.X=function(v){return rJ(v)?m38(this,v):qp(v)?S5X(this,v):sdo(v)?f$T(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};cSX.prototype.T=function(v,J){var G=v.action.actionMetadata.priority-J.action.actionMetadata.priority;G===0&&(v.T<J.T?G=-1:v.T>J.T&&(G=1));return G};g.z(uO,g.X);uO.prototype.X4=function(){this.N&&this.N();g.X.prototype.X4.call(this)};
uO.prototype.createAction=function(v,J){var G=g.bP(v.entityKey).entityType,K=g.lN(16);return new B0(G,K,v,J.actionId,J.rootActionId)};
uO.prototype.Ti=function(v){var J=this,G,K,V,Y,r,E,e,P,D;return g.m(function(t){if(t.T==1){if(J.Sl())return t.return();K=(G=v.offlineOrchestrationActionWrapperEntity)!=null?G:new Set;V=[];Y=g.n(K);for(r=Y.next();!r.done;r=Y.next())E=r.value,e=g.bP(E),P=e.entityId,ASU(J.T,P)||V.push(E);return g.U(t,vfG(J,V),2)}D=t.X;return g.U(t,$Ro(J,D),0)})};
uO.prototype.retry=function(){var v=this;return g.m(function(J){return g.U(J,JzL(v),0)})};ofF.prototype.Tb=function(v,J){J=J===void 0?!0:J;var G=this,K,V,Y,r,E,e,P,D;return g.m(function(t){switch(t.T){case 1:if(!G.T)return t.return();K=[];V=g.WT(G.T.X,J);Y=[];for(r={wr:0};r.wr<V.length;r={wr:r.wr},r.wr++)E=V[r.wr],e=G.T.cD(E,"json3"),P=g.Oi(e,{withCredentials:!0,format:"RAW"},3,500).then(function(B){return function(I){I={metadata:g.IG(V[B.wr]),trackData:I.xhr.responseText};Y.push(I)}}(r)).pj(function(B){v0("Caption fetch error",B)}),K.push(P);
return g.U(t,RCm(K),2);case 2:return g.nf(t,3),g.U(t,MpL(v,Y),5);case 5:g.Rm(t,0);break;case 3:D=g.lj(t),v0("Caption DB transaction error",D),g.zX(t)}})};g.z(gJ,g.X);gJ.prototype.X4=function(){this.X&&this.X();g.X.prototype.X4.call(this)};
gJ.prototype.Z=function(v){var J=this,G,K,V,Y,r,E,e,P;return g.m(function(D){K=(G=v.transfer)!=null?G:new Set;V=[];Y=g.n(K);for(r=Y.next();!r.done;r=Y.next())E=r.value,e=g.bP(E),P=e.entityId,V.push(P);return V.length===0?D.return():g.U(D,Y3L(J,V),0)})};g.z(P6F,g.X);g.q=P6F.prototype;g.q.X4=function(){this.dh&&this.dh();this.Ze.dispose();this.L.dispose();this.YB&&g.ii(this.j.fD,this.YB);this.qr&&g.ii(this.j.fD,this.qr);g.X.prototype.X4.call(this)};
g.q.orh=function(v){var J=this,G,K,V;return g.m(function(Y){switch(Y.T){case 1:G=g.j9(v,"transfer");if(J.T&&G===J.T.key){ZA(J.K,J.J,!0);J.L.stop();Y.sB(0);break}return g.U(Y,Ms(J.X,{mode:"readwrite",jX:!0},function(r){return kh(r,G,"transfer").then(function(E){if(E&&E.transferState!=="TRANSFER_STATE_COMPLETE"&&E.transferState!=="TRANSFER_STATE_FAILED")return E.transferState="TRANSFER_STATE_PAUSED_BY_USER",ar(r,E,"transfer").then(function(){return E})})}),3);
case 3:K=Y.X;if(!K){Y.sB(0);break}if(!v||!J.Z){Y.sB(5);break}return g.U(Y,eM(v,J.Z,J.X,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.U(Y,c0(J,v),7);case 7:V=Y.X,nDY({videoId:v,jR:K,offlineModeType:V}),g.zX(Y)}})};
g.q.ujw=function(){var v=this;if(this.T&&this.J){ZA(this.K,this.J,!1);var J=this.T,G=(J==null?0:J.key)?g.bP(J.key).entityId:"";G&&this.Z&&(new Promise(function(K,V){eM(G,v.Z,v.X,"DOWNLOAD_STATE_PAUSED").catch(function(Y){V(Y)})})).catch(function(K){v0("Download state setting error",K)})}this.L.stop()};
g.q.fh=function(){this.T?Bzo(this,this.T):kk(this)};
g.q.Y8=function(v){var J=this;return g.m(function(G){switch(G.T){case 1:if(!J.T){G.sB(2);break}if(J.T.transferState==="TRANSFER_STATE_COMPLETE"||J.T.transferState==="TRANSFER_STATE_FAILED"||!v.transfer||!v.transfer.has(J.T.key)){G.sB(3);break}return g.U(G,We(J.X,J.T.key,"transfer"),4);case 4:J.T=G.X;if(J.T){G.sB(3);break}return g.U(G,Iv8(J),3);case 3:if(J.T)return G.return();case 2:return g.U(G,kk(J),0)}})};
g.q.pU=function(v,J){var G=this,K,V,Y,r,E;return g.m(function(e){switch(e.T){case 1:if(!G.T){Np(G,"onTransferFailure: "+v);e.sB(2);break}K=G.T;Y=((V=K)==null?0:V.key)?g.bP(K.key).entityId:"";a:switch(v){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var P=!1;break a;default:P=!0}return P&&pYN(G)?g.U(e,aR(G,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.U(e,
LDN(G,v),5);case 5:if(!Y||!G.Z){e.sB(2);break}return g.U(e,eM(Y,G.Z,G.X,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.U(e,c0(G,Y),9);case 9:r=e.X;Vd({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:Y,jR:K,offlineModeType:r});if(!Y||!G.Z){e.sB(2);break}return g.U(e,eM(Y,G.Z,G.X,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Xp(G),E=kk(G,!0),J&&J(E),g.zX(e)}})};
g.q.RF=function(v){var J=this,G,K,V,Y,r,E,e,P,D,t,B,I;return g.m(function(h){switch(h.T){case 1:if(!J.T){Np(J,"onMaybeTransferStreamsExpired");h.sB(2);break}return pYN(J)?g.U(h,aR(J,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.U(h,LDN(J,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!J.Z){h.sB(2);break}G=J.T;V=((K=G)==null?0:K.key)?g.bP(G.key).entityId:"";if(!V){h.sB(2);break}return g.U(h,eM(V,J.Z,J.X,"DOWNLOAD_STATE_FAILED"),2);case 9:return J.T||Np(J,"onMaybeTransferStreamsExpiredRetryAttempting"),
Y=J.T,E=((r=Y)==null?0:r.key)?g.bP(Y.key).entityId:"",g.U(h,c0(J,E),10);case 10:return e=h.X,Vd({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:E,jR:Y,offlineModeType:e}),P=pV6(),g.cX(P,mC,{isEnqueuedForExpiredStreamUrlRefetch:!0}),D=g.j9(E,"playbackData"),t={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:D,actionMetadata:P},B=h8(new B0("playbackData",E,t)),g.U(h,QN(J.X,B,"offlineOrchestrationActionWrapperEntity"),2);case 2:Xp(J),I=kk(J,!0),
v&&v(I),g.zX(h)}})};
var U4U={},yzA=(U4U.TRANSFER_STATE_TRANSFERRING=1,U4U.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,U4U);g.q=A8.prototype;g.q.X1=function(){return this.J.promise};
g.q.mP=function(){if(this.X&&this.K)return this.J.promise;URN(this).then(this.J.resolve).catch(this.J.reject);return this.J.promise};
g.q.R1=function(v){var J={};return J.playbackData=new ewG(v,this.EB,this.T),J.transfer=new U3G(v,this.EB),J.videoPlaybackPositionEntity=new zw6(v,this.EB),J};
g.q.lG=function(){var v=this;return g.m(function(J){return v.X?g.U(J,DRN(v.X),0):J.sB(0)})};
g.q.IZ=function(){var v=this,J,G;return g.m(function(K){if(K.T==1)return v.X||v.K?g.U(K,v.X1(),2):K.return();v.U!==void 0&&(g.ze(v.U),v.U=void 0);v.L!==void 0&&(g.ze(v.L),v.L=void 0);(J=v.X)==null||J.dispose();v.X=void 0;(G=v.K)==null||G.dispose();v.K=void 0;v.api.lw("onOrchestrationLostLeader");v.J=new g.w5;g.zX(K)})};
g.q.isOrchestrationLeader=function(){return this.Z.T};
g.q.Pk=function(){return g.m(function(v){return v.return(!1)})};
g.q.d5=function(v){var J=this.T;J.api.publish("offlinetransferpause",v);var G;(G=J.X)==null||G.postMessage(v)};
g.q.fh=function(v){var J,G;return g.m(function(K){if(K.T==1)return g.U(K,bG(),2);J=K.X;if(!J)return K.return();G=g.j9(v,"transfer");return g.U(K,Ms(J,{mode:"readwrite",jX:!0},function(V){var Y=kh(V,G,"transfer"),r=kh(V,g.j9(v,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.lK.all([Y,r]).then(function(E){E=g.n(E);var e=E.next().value;var P=E.next().value;return e&&e.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(e.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",ar(V,e,"transfer").then(function(){Vd({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:v,jR:e,offlineModeType:P==null?void 0:P.offlineModeType});return g.lK.resolve(null)})):g.lK.resolve(null)})}),0)})};
g.q.kX=function(v){v=v===void 0?43200:v;var J=this,G,K,V,Y,r,E,e,P;return g.m(function(D){if(D.T==1)return J.j.B8()?g.U(D,bG(),2):D.return(xRF());if(D.T!=3){G=D.X;if(!G)return D.return([]);K=Date.now()/1E3;return g.U(D,Cx(G,"offlineVideoPolicy"),3)}V=D.X;Y=[];r=g.n(V);for(E=r.next();!E.done;E=r.next())e=E.value,Number(e.lastUpdatedTimestampSeconds)+v<=K&&(P=g.bP(e.key).entityId,Y.push(P));return Y.length?D.return(Fp(J,Y,J.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):D.return([])})};
g.q.deleteAll=function(){return Fp(this,["!*$_ALL_ENTITIES_!*$"],this.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.q.refreshAllStaleEntities=function(v){var J=this;return g.m(function(G){return G.T==1?g.U(G,J.kX(v),2):G.return(G.X)})};
g.q.setUpPositionSyncInterval=function(v){var J=this;this.L!==void 0&&(g.ze(this.L),this.L=void 0);var G=v!=null?v:864E5;this.L=g.IS(function(){J.j$(G)},G)};
g.q.j$=function(v){var J=this,G,K,V,Y,r,E;return g.m(function(e){switch(e.T){case 1:return g.nf(e,2),g.U(e,uG.getInstance(),4);case 4:G=e.X;if(!G)throw Error("prefStorage is undefined");return g.U(e,G.get("psi"),5);case 5:K=e.X;Y=((V=K)==null?0:V.Ku)?Number(K.Ku)/1E3:0;r=Date.now();if(!(Y+v<=r)){e.sB(6);break}return g.U(e,Fp(J,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Rm(e,0);break;case 2:E=g.lj(e),v0("Offline manager error",E),
g.zX(e)}})};
g.q.Pd=function(){var v=this,J,G,K,V,Y,r,E;return g.m(function(e){if(e.T==1)return g.U(e,bG(),2);if(e.T!=3)return(J=e.X)?g.U(e,Cx(J,"transfer"),3):e.return([]);G=e.X;K=[];V=g.n(G);for(Y=V.next();!Y.done;Y=V.next())r=Y.value,r.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&r.key&&(E=g.bP(r.key).entityId,K.push(E));return e.return(S3_(v,K))})};
g.q.r3=function(){return g.m(function(v){return v.return([])})};
g.q.uI=function(){return g.m(function(v){g.zX(v)})};
g.q.Tt=function(){return g.m(function(v){g.zX(v)})};g.z(fvo,OS);fvo.prototype.X=function(v){return rJ(v)?gfN(this,v):qp(v)?kYY(this,v):ES(v)?czU(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var H0=[10];g.z(H7Y,OS);H7Y.prototype.X=function(v){return rJ(v)?WDL(this,v):qp(v)?C6m(this,v):ES(v)?b7S(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var Q9A=[10];g.z(i4m,OS);i4m.prototype.X=function(v){return qp(v)?v5S(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};g.z(JvN,A8);g.q=JvN.prototype;g.q.R1=function(v){var J=A8.prototype.R1.call(this,v);J.mainVideoEntity=new H7Y(v,this.EB,this.T);J.mainPlaylistEntity=new fvo(v,this.EB,this.T);J.mainDownloadsListEntity=new i4m(v,this.EB,this.T);return J};
g.q.refreshAllStaleEntities=function(v,J){var G=this,K,V,Y,r,E,e,P,D,t,B,I;return g.m(function(h){switch(h.T){case 1:K=[];if(!G.EB.C("web_player_offline_playlist_auto_refresh")){h.sB(2);break}return g.U(h,GmY(G,v,J),3);case 3:K=h.X;case 2:return g.U(h,uG.getInstance(),4);case 4:return V=h.X,g.U(h,(Y=V)==null?void 0:Y.get("sdois"),5);case 5:return r=h.X,g.U(h,(E=V)==null?void 0:E.get("lmqf"),6);case 6:e=h.X;if(!r){h.sB(7);break}D=K;t=D.concat;return g.U(h,o58(G,r,(P=e)!=null?P:"SD",v===0),8);case 8:K=
t.call(D,h.X);case 7:return B=K,I=B.concat,g.U(h,A8.prototype.refreshAllStaleEntities.call(G,v,J),9);case 9:return K=I.call(B,h.X),h.return(K)}})};
g.q.Pk=function(v){var J,G,K,V,Y,r,E,e;return g.m(function(P){if(P.T==1)return g.U(P,bG(),2);if(P.T!=3)return(J=P.X)?g.U(P,We(J,g.Ut,"mainDownloadsListEntity"),3):P.return(!1);G=P.X;if((K=G)==null?0:(V=K.downloads)==null?0:V.length)for(Y=g.j9(v,"mainVideoEntity"),r=g.n(G.downloads),E=r.next();!E.done;E=r.next())if(e=E.value,e.videoItem===Y)return P.return(!0);return P.return(!1)})};
g.q.r3=function(){var v=this,J,G,K,V,Y,r,E,e;return g.m(function(P){if(P.T==1)return g.U(P,bG(),2);if(P.T!=3)return(J=P.X)?g.U(P,Cx(J,"downloadStatusEntity"),3):P.return([]);G=P.X;K=[];V=g.n(G);for(Y=V.next();!Y.done;Y=V.next())r=Y.value,r.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&r.key&&(E=g.bP(r.key).entityId,K.push(E));return K.length?(e={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},P.return(Fp(v,K,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
e))):P.return([])})};
g.q.Tt=function(){var v;return g.m(function(J){return J.T==1?g.U(J,bG(),2):(v=J.X)?g.U(J,Ms(v,{mode:"readwrite",jX:!0},function(G){return ce(G,"mainVideoEntity").then(function(K){var V=[];K=g.n(K);for(var Y=K.next();!Y.done;Y=K.next()){Y=Y.value;var r=void 0;(r=Y.userState)!=null&&r.playbackPosition||(r=g.bP(Y.key).entityId,r={key:g.j9(r,"videoPlaybackPositionEntity"),videoId:r,lastPlaybackPositionSeconds:"0"},V.push(ar(G,r,"videoPlaybackPositionEntity")),Y.userState={playbackPosition:r.key},V.push(ar(G,
Y,"mainVideoEntity")))}return g.lK.all(V)})}),0):J.return()})};
g.q.uI=function(){var v,J,G,K,V,Y,r,E,e,P,D,t,B,I,h,R,T,L,O,x,f,c,b,M,Jw,Kf,j8,a,C,d,A,cF,RL,BN,pf,iU,VY,IL;return g.m(function(p){if(p.T==1)return g.U(p,bG(),2);if(p.T!=3){v=p.X;if(!v)return p.return();J=g.j9("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.U(p,Ms(v,{mode:"readonly",jX:!0},function(y){return g.lK.all([kh(y,J,"mainDownloadsListEntity"),kh(y,g.Ut,"mainDownloadsListEntity"),ce(y,"mainVideoEntity"),ce(y,"mainPlaylistEntity")])}),3)}G=p.X;
K=g.n(G);V=K.next().value;Y=K.next().value;r=K.next().value;E=K.next().value;e=V;P=Y;D=r;t=E;B=new Set;if((I=e)==null?0:(h=I.downloads)==null?0:h.length)for(R=g.n(e.downloads),T=R.next();!T.done;T=R.next())L=T.value,O=void 0,(x=(O=L.videoItem)!=null?O:L.playlistItem)&&B.add(x);if((f=P)==null?0:(c=f.downloads)==null?0:c.length)for(b=g.n(P.downloads),M=b.next();!M.done;M=b.next())Jw=M.value,Jw.videoItem&&B.add(Jw.videoItem);Kf=new Set;j8=[];a=g.n(t);for(C=a.next();!C.done;C=a.next()){d=C.value;if(d.videos)for(A=
g.n(d.videos),cF=A.next();!cF.done;cF=A.next())RL=cF.value,(BN=JSON.parse(g.bP(RL).entityId).videoId)&&Kf.add(BN);d.key&&!B.has(d.key)&&j8.push(d.key)}pf=g.n(D);for(iU=pf.next();!iU.done;iU=pf.next())VY=iU.value,VY.key&&!B.has(VY.key)&&(IL=g.bP(VY.key).entityId,Kf.has(IL)||j8.push(VY.key));return j8.length?g.U(p,XV_(v,j8),0):p.sB(0)})};g.z(KON,OS);KON.prototype.X=function(v){return rJ(v)?YEY(this,v):qp(v)?rv8(this,v):ES(v)?qEU(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var Qd=[10];g.z(eZG,OS);eZG.prototype.X=function(v){return rJ(v)?D4o(this,v):qp(v)?tw6(this,v):ES(v)?B_L(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var W0=[10];g.z(zZY,OS);zZY.prototype.X=function(v){return rJ(v)?RZ8(this,v):qp(v)?lmm(this,v):ES(v)?T_L(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var syT=[10];g.z(CZ,A8);CZ.prototype.R1=function(v){var J=A8.prototype.R1.call(this,v);J.musicTrack=new zZY(v,this.T);J.musicPlaylist=new eZG(v,this.T);J.musicAlbumRelease=new KON(v,this.T);return J};
CZ.prototype.refreshAllStaleEntities=function(v,J){var G=this,K,V,Y;return g.m(function(r){if(r.T==1)return g.U(r,LOm(G,v,J),2);if(r.T!=3)return V=K=r.X,Y=V.concat,g.U(r,A8.prototype.refreshAllStaleEntities.call(G,v,J),3);K=Y.call(V,r.X);return r.return(K)})};g.z(yvF,g.YQ);g.q=yvF.prototype;g.q.create=function(){var v=this;g.k(this,this.events);g.bh(this.EB)?this.T=new JvN(this.EB,this.player):g.gy(this.EB)&&(this.T=new CZ(this.EB,this.player));this.events.G(this.player,"onPlaybackStartExternal",function(){v.d4()});
this.events.G(this.player,"videodatachange",function(){v.d4()});
this.EB.C("html5_offline_playback_position_sync")&&this.events.G(this.player,"presentingplayerstatechange",this.G3)};
g.q.Ff=function(){return!1};
g.q.Gw=function(v,J,G,K){var V=this;return g.m(function(Y){return V.T?Y.return(Fp(V.T,v,J,G,K)):Y.return(Promise.reject())})};
g.q.deleteAll=function(){return this.T.deleteAll()};
g.q.kX=function(v){return this.T.kX(v)};
g.q.refreshAllStaleEntities=function(v){return this.T.refreshAllStaleEntities(v)};
g.q.setUpPositionSyncInterval=function(v){this.T.setUpPositionSyncInterval(v)};
g.q.d5=function(v){this.T.d5(v)};
g.q.fh=function(v){return this.T.fh(v)};
g.q.d4=function(){var v=this,J;return g.m(function(G){J=v.player.getVideoData();return g.im(J)?w$A(J)&&v.X!==J.clientPlaybackNonce?g.U(G,O4L(v,J),0):G.sB(0):G.return()})};
g.q.G3=function(v){var J=this,G,K,V,Y,r,E,e;return g.m(function(P){if(P.T==1)return G=J.player.getVideoData(),K=G.xB,g.Bs(v,2)||g.Bs(v,512)?g.U(P,bG(),2):P.return();if(P.T!=3){V=P.X;if(!V)return v0("PES is undefined"),P.return();Y=G.videoId;return g.U(P,We(V,g.j9(Y,"mainVideoEntity"),"mainVideoEntity"),3)}r=P.X;if(!r)return P.return();E=Math.floor(K).toString();e={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:E}};return g.U(P,J.Gw([Y],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
e),0)})};
g.q.isOrchestrationLeader=function(){return this.T.isOrchestrationLeader()};
g.q.updateDownloadState=function(v,J){var G,K,V,Y;return g.m(function(r){if(r.T==1)return g.U(r,bG(),2);G=r.X;if(!G)return v0("PES is undefined"),r.return();K=g.bP(v);V=K.entityType;Y=K.entityId;return g.U(r,eM(Y,V,G,J,!0),0)})};g.Vp("offline",yvF);})(_yt_player);
